<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ãƒ™ãƒ­ãƒ¡ãƒ¼ã‚¿ãƒ¼ by ä¸–ç•Œç‹</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Zen+Old+Mincho:wght@400;700;900&family=Noto+Sans+JP:wght@300;500;700;900&display=swap');
:root{
  --bg:#050508;--bg2:#0a0a12;--gold:#c9a84c;--gold2:#8a6e30;--gold3:#e8c960;
  --wht:#e0dcd0;--grey:#444460;--red:#d03030;--red2:#801818;--red3:#ff4040;
  --green:#30a050;--cyan:#40c0d0;--yellow:#e0c030;--orange:#e08030;--pink:#d060a0;--purple:#8040c0;
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;background:var(--bg);color:var(--wht);font-family:'Noto Sans JP',sans-serif;overflow:hidden;-webkit-tap-highlight-color:transparent;user-select:none}
body::after{content:'';position:fixed;inset:0;background:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay}

.sc{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;opacity:0;transform:scale(0.97);transition:opacity 0.7s,transform 0.7s;pointer-events:none;z-index:1}
.sc.on{opacity:1;transform:scale(1);pointer-events:auto}
.sc.scroll{overflow-y:auto;justify-content:flex-start;padding-top:max(24px,3vh);padding-bottom:60px}

.intro-icon{font-size:72px;margin-bottom:8px;animation:bounce 2s ease-in-out infinite}
@keyframes bounce{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-12px) scale(1.05)}}
.app-title{font-family:'Zen Old Mincho',serif;font-size:clamp(48px,12vw,72px);font-weight:900;background:linear-gradient(135deg,var(--gold3),var(--orange),var(--red3));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center;line-height:1.1}
.app-sub{font-size:clamp(13px,3.2vw,16px);color:var(--grey);letter-spacing:0.2em;margin-top:4px}
.app-desc{font-size:clamp(14px,3.5vw,17px);text-align:center;margin-top:20px;line-height:1.8;max-width:360px;opacity:0.7}
.app-desc em{color:var(--gold3);font-style:normal;font-weight:700}
.big-btn{margin-top:28px;width:min(320px,80vw);padding:20px 0;background:linear-gradient(135deg,var(--red2),var(--red));border:none;border-radius:8px;color:#fff;font-family:'Zen Old Mincho',serif;font-size:clamp(22px,5.5vw,28px);font-weight:700;letter-spacing:0.2em;cursor:pointer;box-shadow:0 4px 20px rgba(208,48,48,0.3)}
.big-btn:active{transform:scale(0.96)}
.privacy-note{font-size:clamp(9px,2.3vw,11px);color:var(--grey);margin-top:16px;opacity:0.5;text-align:center}

/* MODE SELECT */
.mode-title{font-family:'Zen Old Mincho',serif;font-size:clamp(24px,6vw,32px);font-weight:900;text-align:center;margin-bottom:8px}
.mode-sub{font-size:clamp(13px,3.2vw,16px);color:var(--gold2);text-align:center;margin-bottom:24px;letter-spacing:0.1em}
.mode-cards{display:flex;flex-direction:column;gap:12px;width:min(380px,88vw)}
.mode-card{width:100%;padding:18px 16px;background:rgba(255,255,255,0.02);border:1px solid rgba(201,168,76,0.15);border-radius:8px;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;gap:14px;text-align:left;position:relative}
.mode-card:active{transform:scale(0.97);background:rgba(201,168,76,0.08);border-color:var(--gold)}
.mode-card.locked{border-color:rgba(201,168,76,0.08)}
.mode-emoji{font-size:clamp(36px,9vw,48px);flex-shrink:0}
.mode-info{flex:1}
.mode-name{font-family:'Zen Old Mincho',serif;font-size:clamp(18px,4.5vw,24px);font-weight:700;margin-bottom:4px}
.mode-desc{font-size:clamp(12px,3vw,14px);color:var(--grey);line-height:1.5}
.mode-tag{display:inline-block;font-size:clamp(10px,2.5vw,11px);padding:2px 8px;border-radius:10px;margin-top:4px;font-weight:700}
.tag-free{background:rgba(48,160,80,0.15);color:var(--green)}
.tag-sing{background:rgba(208,96,160,0.15);color:var(--pink)}
.tag-sexy{background:rgba(208,48,48,0.15);color:var(--red3)}
.tag-long{background:rgba(64,192,208,0.15);color:var(--cyan)}
.tag-premium{background:rgba(201,168,76,0.2);color:var(--gold3);margin-left:4px}
.lock-badge{position:absolute;top:10px;right:12px;font-size:clamp(10px,2.5vw,12px);color:var(--gold);background:rgba(201,168,76,0.12);border:1px solid rgba(201,168,76,0.25);border-radius:12px;padding:2px 10px;font-weight:700;letter-spacing:0.05em}
.lock-badge.unlocked{color:var(--green);background:rgba(48,160,80,0.12);border-color:rgba(48,160,80,0.25)}

.manual-box{width:min(380px,90vw);text-align:center;margin-top:16px}
.manual-link{font-size:13px;color:var(--gold2);text-decoration:underline;cursor:pointer}

/* PAID UNLOCK TOAST */
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,rgba(48,160,80,0.95),rgba(30,120,60,0.95));color:#fff;padding:14px 24px;border-radius:10px;font-size:clamp(14px,3.5vw,17px);font-weight:700;z-index:200;opacity:0;transition:opacity 0.4s,transform 0.4s;pointer-events:none;box-shadow:0 4px 20px rgba(0,0,0,0.3);text-align:center}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* COUNTDOWN */
.cd-num{font-family:'Zen Old Mincho',serif;font-size:clamp(120px,30vw,180px);font-weight:900;color:var(--gold);text-shadow:0 0 60px rgba(201,168,76,0.4);opacity:0;transform:scale(2)}
.cd-num.pop{animation:cdPop 0.8s ease forwards}
@keyframes cdPop{0%{opacity:0;transform:scale(2.5)}20%{opacity:1;transform:scale(0.9)}35%{transform:scale(1.05)}50%{transform:scale(1)}80%{opacity:1}100%{opacity:0;transform:scale(0.6)}}
.cd-sub{font-size:clamp(16px,4vw,22px);color:var(--grey);letter-spacing:0.2em;margin-top:12px}
.cd-ring{position:absolute;width:200px;height:200px;border:3px solid transparent;border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite;opacity:0.3}
@keyframes spin{to{transform:rotate(360deg)}}

/* MEASURE */
.m-title{font-family:'Zen Old Mincho',serif;font-size:clamp(22px,5.5vw,30px);font-weight:700;margin-bottom:8px;text-align:center}
.m-mode-label{font-size:clamp(14px,3.5vw,18px);color:var(--pink);text-align:center;margin-bottom:16px;letter-spacing:0.1em;font-weight:700}
#noiseCanvas{width:min(380px,90vw);height:120px;border:1px solid rgba(201,168,76,0.15);border-radius:6px;background:var(--bg2);margin-bottom:12px}
.gauge-num{font-family:'Zen Old Mincho',serif;font-size:clamp(48px,12vw,72px);font-weight:900;text-align:center;margin-bottom:6px;transition:color 0.3s}
.gauge-wrap{width:min(380px,90vw);height:36px;background:var(--bg2);border:1px solid rgba(201,168,76,0.15);border-radius:18px;overflow:hidden;margin-bottom:10px}
.gauge-fill{height:100%;border-radius:18px;transition:width 0.1s;overflow:hidden;position:relative}
.gauge-fill::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.12),transparent);animation:shimmer 1.2s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.timer-text{font-size:clamp(14px,3.5vw,17px);color:var(--grey);text-align:center;margin-bottom:14px}
.stop-btn{padding:12px 36px;background:rgba(100,100,120,0.2);border:1px solid var(--grey);border-radius:6px;color:var(--grey);font-size:16px;cursor:pointer}

/* MANUAL */
input[type=range]{width:100%;height:40px;-webkit-appearance:none;background:transparent;margin-bottom:12px}
input[type=range]::-webkit-slider-runnable-track{height:8px;background:linear-gradient(90deg,var(--cyan),var(--green),var(--yellow),var(--orange),var(--red3));border-radius:4px}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:36px;height:36px;background:var(--gold);border-radius:50%;margin-top:-14px}
.manual-go{padding:14px 40px;background:var(--red);border:none;border-radius:6px;color:#fff;font-size:20px;font-weight:700;cursor:pointer}

/* ANALYZE */
.az-emoji{font-size:80px;animation:azB 0.6s ease-in-out infinite alternate}
@keyframes azB{0%{transform:scale(1) rotate(-5deg)}100%{transform:scale(1.15) rotate(5deg)}}
.az-text{font-family:'Zen Old Mincho',serif;font-size:clamp(26px,6.5vw,36px);font-weight:900;text-align:center;margin-top:16px;line-height:1.5}
.az-sub{font-size:clamp(14px,3.5vw,18px);color:var(--gold2);margin-top:12px;animation:pulse 1s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:0.3}50%{opacity:1}}
.az-dots{display:flex;gap:12px;margin-top:20px}
.az-dot{width:12px;height:12px;background:var(--gold);border-radius:50%;animation:dotP 1.2s ease-in-out infinite}
.az-dot:nth-child(2){animation-delay:0.2s}.az-dot:nth-child(3){animation-delay:0.4s}
@keyframes dotP{0%,100%{opacity:0.2;transform:scale(0.8)}50%{opacity:1;transform:scale(1.2)}}

/* RESULT */
@keyframes shake{0%,100%{transform:translateX(0)}10%{transform:translateX(-8px) rotate(-1deg)}20%{transform:translateX(8px) rotate(1deg)}30%{transform:translateX(-5px)}40%{transform:translateX(5px)}50%{transform:translateX(-3px)}60%{transform:translateX(3px)}}
.shaking{animation:shake 0.6s ease}
.res-flash{position:fixed;inset:0;background:#fff;opacity:0;pointer-events:none;z-index:50}
.res-flash.bang{opacity:0.7;transition:none}
.confetti-box{position:fixed;inset:0;pointer-events:none;z-index:40;overflow:hidden}
.confetti{position:absolute;opacity:0;animation:cFall var(--dur) var(--del) ease-in forwards}
@keyframes cFall{0%{opacity:1;transform:translateY(-20px) rotate(0) scale(1)}80%{opacity:0.8}100%{opacity:0;transform:translateY(100vh) rotate(720deg) scale(0.3)}}

.res-emoji2{font-size:80px;margin-bottom:4px}
.res-emoji2.dramatic{animation:resDrama 0.8s ease forwards}
@keyframes resDrama{0%{transform:scale(0) rotate(-180deg);opacity:0}50%{transform:scale(1.5) rotate(10deg);opacity:1}70%{transform:scale(0.9) rotate(-5deg)}100%{transform:scale(1) rotate(0)}}
.res-label{font-family:'Zen Old Mincho',serif;font-size:clamp(24px,6vw,36px);font-weight:900;text-align:center;margin-bottom:4px;letter-spacing:0.12em;opacity:0}
.res-label.slideIn{animation:slideIn 0.6s 0.3s ease forwards}
@keyframes slideIn{from{opacity:0;transform:translateY(20px) scale(0.8)}to{opacity:1;transform:translateY(0) scale(1)}}
.res-num-wrap{position:relative;margin-bottom:4px}
.res-num{font-family:'Zen Old Mincho',serif;font-size:clamp(100px,25vw,150px);font-weight:900;text-align:center;line-height:1;opacity:0}
.res-num.countUp{animation:numA 0.4s 0.6s ease forwards}
@keyframes numA{from{opacity:0;transform:scale(1.5)}to{opacity:1;transform:scale(1)}}
.res-unit{font-size:clamp(16px,4vw,20px);color:var(--grey);text-align:center;margin-bottom:12px;opacity:0}
.res-unit.fadeIn{animation:fi2 0.4s 1.2s ease forwards}
@keyframes fi2{to{opacity:1}}
.res-glow{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:200px;height:200px;border-radius:50%;filter:blur(40px);opacity:0;animation:glowP 3s 0.8s ease-in-out infinite}
@keyframes glowP{0%,100%{opacity:0.15;transform:translate(-50%,-50%) scale(0.9)}50%{opacity:0.4;transform:translate(-50%,-50%) scale(1.15)}}

.res-mode-badge{display:inline-block;padding:4px 14px;border-radius:12px;font-size:clamp(11px,2.8vw,13px);font-weight:700;margin-bottom:14px;letter-spacing:0.1em;opacity:0}
.res-mode-badge.fadeIn{animation:fi2 0.3s 1s ease forwards}
.badge-sing{background:rgba(208,96,160,0.2);color:var(--pink);border:1px solid rgba(208,96,160,0.3)}
.badge-sexy{background:rgba(208,48,48,0.2);color:var(--red3);border:1px solid rgba(208,48,48,0.3)}
.badge-long{background:rgba(64,192,208,0.2);color:var(--cyan);border:1px solid rgba(64,192,208,0.3)}

.res-box{width:min(380px,90vw);background:rgba(255,255,255,0.03);border:1px solid rgba(201,168,76,0.1);border-radius:6px;padding:16px 20px;margin-bottom:14px;text-align:center}
.res-box-title{font-size:clamp(11px,2.8vw,13px);color:var(--gold);letter-spacing:0.3em;margin-bottom:8px}
.res-box-text{font-size:clamp(16px,4vw,20px);line-height:1.9}
.res-prophecy{width:min(380px,90vw);background:rgba(100,30,100,0.08);border:1px solid rgba(128,64,192,0.15);border-radius:6px;padding:16px 20px;margin-bottom:14px;text-align:center}
.res-prophecy-title{font-size:clamp(11px,2.8vw,13px);color:var(--purple);letter-spacing:0.3em;margin-bottom:8px}
.res-prophecy-text{font-size:clamp(15px,3.8vw,19px);color:rgba(200,180,220,0.85);line-height:1.8}
.sake-box{width:min(380px,90vw);margin-bottom:14px}
.sake-title{font-family:'Zen Old Mincho',serif;font-size:clamp(13px,3.2vw,15px);color:var(--gold);letter-spacing:0.15em;margin-bottom:10px}
.sake-card{background:rgba(255,255,255,0.02);border:1px solid rgba(201,168,76,0.1);border-radius:5px;padding:12px 14px;margin-bottom:8px}
.sake-role{font-size:clamp(10px,2.5vw,12px);letter-spacing:0.15em;margin-bottom:4px;font-weight:700}
.sake-role.brake{color:var(--cyan)}.sake-role.calm{color:var(--green)}.sake-role.yolo{color:var(--red3)}
.sake-name{font-size:clamp(14px,3.5vw,17px);font-weight:700;margin-bottom:2px}
.sake-note{font-size:clamp(10px,2.5vw,12px);color:var(--grey);line-height:1.5}
.king-box{width:min(380px,90vw);border-top:1px solid rgba(160,40,40,0.15);padding-top:12px;margin-bottom:14px;text-align:center;display:none}
.king-box.show{display:block}
.king-label{font-size:clamp(9px,2.3vw,11px);color:var(--red2);letter-spacing:0.3em;margin-bottom:4px}
.king-text{font-family:'Zen Old Mincho',serif;font-size:clamp(14px,3.5vw,17px);color:var(--gold);line-height:1.8}
.retry-btn{margin-top:8px;width:min(320px,80vw);padding:18px 0;background:linear-gradient(135deg,rgba(201,168,76,0.1),rgba(201,168,76,0.05));border:1px solid var(--gold2);border-radius:8px;color:var(--gold);font-family:'Zen Old Mincho',serif;font-size:clamp(18px,4.5vw,22px);letter-spacing:0.2em;cursor:pointer}
.retry-btn:active{transform:scale(0.96)}
.ft{margin-top:16px;text-align:center;opacity:0.2;font-size:9px;color:var(--grey);line-height:2}
.fi{animation:fu 0.8s ease both}
@keyframes fu{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
.d1{animation-delay:.1s;opacity:0}.d2{animation-delay:.25s;opacity:0}.d3{animation-delay:.4s;opacity:0}
.d4{animation-delay:.7s;opacity:0}.d5{animation-delay:.9s;opacity:0}.d6{animation-delay:1.1s;opacity:0}
.d7{animation-delay:1.3s;opacity:0}.d8{animation-delay:1.5s;opacity:0}.d9{animation-delay:1.7s;opacity:0}
.lv0{color:var(--cyan)}.lv1{color:var(--green)}.lv2{color:var(--yellow)}.lv3{color:var(--orange)}.lv4{color:var(--red3)}
</style>
</head>
<body>
<div class="res-flash" id="flash"></div>
<div class="confetti-box" id="confettiBox"></div>
<div class="toast" id="toast"></div>

<div class="sc on" id="s-intro">
  <div class="intro-icon">ğŸº</div>
  <div class="app-title">ãƒ™ãƒ­<br>ãƒ¡ãƒ¼ã‚¿ãƒ¼</div>
  <div class="app-sub">BERO METER</div>
  <div class="app-desc">ãƒã‚¤ã‚¯ã«å‘ã‹ã£ã¦<em>å£°ã‚„æ¯</em>ã‚’å…¥ã‚Œã‚‹ã ã‘ã€‚<br>ã‚ãªãŸã®<em>é…”ã„åº¦</em>ã‚’æš´ãã¾ã™ã€‚</div>
  <button class="big-btn" onclick="show('s-mode')">ğŸŒ¬ æ¸¬å®šé–‹å§‹</button>
  <div class="privacy-note">ğŸ”’ éŸ³å£°ã¯ä¿å­˜ã—ã¾ã›ã‚“ï¼ˆæ¼”å‡ºç”¨ï¼‰</div>
  <div class="ft" style="margin-top:24px">
    ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¢ãƒ¼ãƒ‰ï¼šÂ¥300ï¼ˆç¨è¾¼ãƒ»è²·ã„åˆ‡ã‚Šï¼‰<br>
    æ±ºæ¸ˆï¼šStripeï¼ˆã‚«ãƒ¼ãƒ‰ / Apple Pay / Google Pay / PayPayï¼‰<br>
    <a href="https://hideo-t.github.io/negaibi/#tokushoho" style="color:var(--gold2);font-size:9px">ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜</a><br>
    Presented by ä¸–ç•Œç‹ / <a href="https://hideo-t.github.io/negaibi/" style="color:var(--gold2);font-size:9px">é¡˜ã„ç¯</a>
  </div>
</div>

<!-- MODE SELECT -->
<div class="sc" id="s-mode">
  <div class="mode-title">ğŸ­ ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã¹</div>
  <div class="mode-sub">è¦šæ‚Ÿã¯ã„ã„ã‹ï¼Ÿ</div>
  <div class="mode-cards">
    <div class="mode-card" onclick="selectMode('sexy')">
      <div class="mode-emoji">ğŸ’‹</div>
      <div class="mode-info">
        <div class="mode-name">è‰²ã£ã½ãå¹ã</div>
        <div class="mode-desc">3ç§’é–“ã€ã‚»ã‚¯ã‚·ãƒ¼ã«æ¯ã‚’â€¦<br>ãƒ•ã‚¥ã€œã€œãƒƒâ™¡</div>
        <div><span class="mode-tag tag-free">ğŸ†“ ç„¡æ–™</span><span class="mode-tag tag-sexy">æ¥ãšã‹ã—ã•â˜…â˜…â˜…</span></div>
      </div>
    </div>
    <div class="mode-card" id="card-sing" onclick="selectMode('sing')">
      <div class="mode-emoji">ğŸ¤</div>
      <div class="mode-info">
        <div class="mode-name">æ­Œã£ã¦æ¸¬å®š</div>
        <div class="mode-desc">æ­Œã«è‡ªä¿¡ã‚ã‚‹æ–¹ï½—<br>10ç§’é–“ã€æœ¬æ°—ã§æ­Œãˆï¼</div>
        <div><span class="mode-tag tag-sing">é›£æ˜“åº¦â˜…â˜…â˜…</span><span class="mode-tag tag-premium" id="tagSing">ğŸ‘‘ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ </span></div>
      </div>
      <div class="lock-badge" id="lockSing">ğŸ”’ Â¥300</div>
    </div>
    <div class="mode-card" id="card-long" onclick="selectMode('long')">
      <div class="mode-emoji">ğŸ«</div>
      <div class="mode-info">
        <div class="mode-name">æ¯ãƒ­ãƒ³ã‚°ãƒ¬ãƒ³ã‚¸</div>
        <div class="mode-desc">æ¯åˆ‡ã‚Œã™ã‚‹ã¾ã§å¹ãç¶šã‘ã‚ï¼<br>æœ€å¤§20ç§’ã€‚è‚ºæ´»é‡å‹è² ï¼</div>
        <div><span class="mode-tag tag-long">ä½“åŠ›â˜…â˜…â˜…</span><span class="mode-tag tag-premium" id="tagLong">ğŸ‘‘ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ </span></div>
      </div>
      <div class="lock-badge" id="lockLong">ğŸ”’ Â¥300</div>
    </div>
  </div>
  <div class="manual-box" style="margin-top:16px">
    <div class="manual-link" onclick="selectMode('manual')">ãƒã‚¤ã‚¯ãŒä½¿ãˆãªã„äººã¯ã“ã¡ã‚‰</div>
    <div style="margin-top:14px;font-size:10px;color:var(--grey);line-height:1.8;opacity:0.6">
      ğŸ‘‘ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¢ãƒ¼ãƒ‰ï¼šÂ¥300ï¼ˆç¨è¾¼ãƒ»è²·ã„åˆ‡ã‚Šï¼‰<br>
      <a href="https://hideo-t.github.io/negaibi/#tokushoho" style="color:var(--gold2)">ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜</a>
    </div>
  </div>
</div>

<div class="sc" id="s-cd">
  <div class="cd-ring"></div>
  <div class="cd-num" id="cdNum">3</div>
  <div class="cd-sub" id="cdSub">æº–å‚™ã—ã¦â€¦</div>
</div>

<div class="sc" id="s-measure">
  <div class="m-title" id="mTitle"></div>
  <div class="m-mode-label" id="mLabel"></div>
  <canvas id="noiseCanvas"></canvas>
  <div class="gauge-num" id="gaugeNum">0</div>
  <div class="gauge-wrap"><div class="gauge-fill" id="gaugeFill" style="width:0%"></div></div>
  <div class="timer-text" id="timerText"></div>
  <button class="stop-btn" onclick="stopEarly()">ã‚‚ã†ãƒ ãƒªï¼</button>
</div>

<div class="sc" id="s-manual">
  <div class="mode-title">ğŸš æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰</div>
  <div style="font-size:16px;color:var(--grey);margin-bottom:16px">ä»Šã®é…”ã„å…·åˆã‚’è‡ªå·±ç”³å‘Šã›ã‚ˆ</div>
  <div style="width:min(380px,88vw)">
    <input type="range" min="0" max="100" value="50" id="manualRange" oninput="document.getElementById('manualVal').textContent=this.value">
    <div id="manualVal" style="color:var(--gold);font-size:24px;text-align:center;margin-bottom:16px">50</div>
    <button class="big-btn" style="width:100%" onclick="manualGo()">ã“ã‚Œã§åˆ¤å®šï¼</button>
  </div>
</div>

<div class="sc" id="s-analyze">
  <div class="az-emoji" id="azEmoji">ğŸ”¬</div>
  <div class="az-text" id="azText"></div>
  <div class="az-sub">è¨ºæ–­ä¸­â€¦</div>
  <div class="az-dots"><div class="az-dot"></div><div class="az-dot"></div><div class="az-dot"></div></div>
</div>

<div class="sc scroll" id="s-result"></div>

<script>
// ============ STRIPE PAYMENT ============
const PAYMENT_URL = 'https://buy.stripe.com/bJebJ08ajfF2dJAfSyb7y01';

function isPaid(){
  return localStorage.getItem('bero_premium')==='1';
}

function checkPaidParam(){
  const p = new URLSearchParams(window.location.search);
  if(p.get('paid')==='1'){
    localStorage.setItem('bero_premium','1');
    // Clean URL
    window.history.replaceState({},'',window.location.pathname);
    showToast('ğŸ‰ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ è§£æ”¾ï¼å…¨ãƒ¢ãƒ¼ãƒ‰ä½¿ãˆã¾ã™ï¼');
  }
}

function updateModeUI(){
  const paid = isPaid();
  if(paid){
    document.getElementById('lockSing').textContent='âœ… è§£æ”¾æ¸ˆ';
    document.getElementById('lockSing').classList.add('unlocked');
    document.getElementById('lockLong').textContent='âœ… è§£æ”¾æ¸ˆ';
    document.getElementById('lockLong').classList.add('unlocked');
    document.getElementById('tagSing').style.display='none';
    document.getElementById('tagLong').style.display='none';
  }
}

function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3000);
}

// Init on load
checkPaidParam();
// ========================================

const SAKE={
brake:[
  {name:"åå€‰å±± æœˆå¼“ï¼ˆåå€‰å±±é…’é€ ï¼‰",note:"ãã‚Œã„ãªç”˜ã•ã§ãƒ–ãƒ¬ãƒ¼ã‚­",temp:"å†·é…’"},
  {name:"ç”²å­å±± ç´”ç±³åŸé†¸ï¼ˆæœ‰è³€é†¸é€ Ã—è¥¿éƒ·æ‘ï¼‰",note:"è¥¿éƒ·æ‘åˆã®åœ°é…’ã€‚ã“ã“ã§ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³",temp:"å†·é…’"},
  {name:"ã‹ã‚’ã‚‹ã‚„ã¾ï¼ˆä»äº•ç”°æœ¬å®¶ï¼‰",note:"ãŠç±³ã®ç™½ãƒ¯ã‚¤ãƒ³ã€‚ä½ALCã§ç€åœ°",temp:"å†·é…’"},
  {name:"å±±ã®äº• ç´”ç±³ï¼ˆä¼šæ´¥é…’é€ ï¼‰",note:"ALC14%ã€‚è»½ã‚„ã‹ã‚½ãƒ•ãƒˆãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°",temp:"å†·é…’"},
  {name:"å¥ˆè‰¯è¬ ç´”ç±³é…’ï¼ˆå¤¢å¿ƒé…’é€ ï¼‰",note:"èƒƒã«å„ªã—ã„ä¸‡èƒ½ãƒ–ãƒ¬ãƒ¼ã‚­",temp:"å†·é…’ï½å¸¸æ¸©"},
  {name:"å†©æ¨‚ ç´”ç±³é…’ï¼ˆå®®æ³‰éŠ˜é†¸ï¼‰",note:"ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ã ã‘ã©ã‚­ãƒ¬ãŒã‚ã‚‹",temp:"å†·é…’"},
  {name:"é›ªå°ç”º ç´”ç±³é…’ï¼ˆæ¸¡è¾ºé…’é€ æœ¬åº—ï¼‰",note:"ç©ã‚„ã‹ã€‚ã“ã“ã§æ­¢ã¾ã‚Œ",temp:"å†·é…’"},
  {name:"æ¦®å· ç‰¹åˆ¥ç´”ç±³é…’ï¼ˆæ¦®å·é…’é€ ï¼‰",note:"ç£æ¢¯å±±ã®æ°´ã€‚ã¾ã‚ã‚„ã‹ãƒ–ãƒ¬ãƒ¼ã‚­",temp:"å†·é…’"},
],calm:[
  {name:"å¤§ä¸ƒ ç´”ç±³ç”Ÿé…›ï¼ˆå¤§ä¸ƒé…’é€ ï¼‰",note:"ç‡—ã§æ­£æ°—ã«æˆ»ã‚Œ",temp:"ã¬ã‚‹ç‡—"},
  {name:"ä¼æ‰¿å±±å»ƒç´”ç±³ æœ«å»£ï¼ˆæœ«å»£é…’é€ ï¼‰",note:"ç‡—ã§ç‘æƒ³ã—ã‚",temp:"ã¬ã‚‹ç‡—"},
  {name:"ä¼šæ´¥ä¸­å°† ç´”ç±³é…’ï¼ˆé¶´ä¹ƒæ±Ÿé…’é€ ï¼‰",note:"æ¸©ã‹ã•ã§æ•´ãˆ",temp:"ç‡—"},
  {name:"ã«ã„ã ã—ãœã‚“ã—ã‚… ç‡—èª‚ï¼ˆä»äº•ç”°æœ¬å®¶ï¼‰",note:"ç‡—å°‚ç”¨ã€‚ç†æ€§ã‚’å–ã‚Šæˆ»ã›",temp:"ã¬ã‚‹ç‡—"},
  {name:"å›½æ¨© å±±å»ƒç´”ç±³ï¼ˆå›½æ¨©é…’é€ ï¼‰",note:"å—ä¼šæ´¥ã®éª¨æ ¼ã€‚ã—ã£ã‹ã‚Šåº§ã‚Œ",temp:"ç‡—"},
  {name:"èŠ±æ˜¥ æ¿ƒé†‡ç´”ç±³ï¼ˆèŠ±æ˜¥é…’é€ ï¼‰",note:"æ¿ƒã„ã‚ã§æ•´ã†",temp:"ã¬ã‚‹ç‡—"},
  {name:"å»£æˆ¸å· ç‰¹åˆ¥ç´”ç±³ï¼ˆæ¾å´é…’é€ ï¼‰",note:"è¾›å£ã®ã‚­ãƒ¬ã§ç›®ã‚’è¦šã¾ã›",temp:"å†·é…’"},
  {name:"å¼¥å³è¡›é–€ è¾›å£ï¼ˆå¤§å’Œå·é…’é€ åº—ï¼‰",note:"+8ã€‚ç”˜ã„å¤¢ã‹ã‚‰è¦šã‚ã‚",temp:"å†·é…’"},
],yolo:[
  {name:"é£›éœ²å–œ ç‰¹åˆ¥ç´”ç±³ï¼ˆå»£æœ¨é…’é€ æœ¬åº—ï¼‰",note:"æœ€é«˜ã®é…’ã§æ•£ã‚Œ",temp:"å†·é…’"},
  {name:"å†©æ¨‚ ãŠã‚ŠãŒã‚‰ã¿ï¼ˆå®®æ³‰éŠ˜é†¸ï¼‰",note:"ã‚·ãƒ¥ãƒ¯ã‚·ãƒ¥ãƒ¯åŠ é€Ÿã€‚ã‚‚ã†çŸ¥ã‚‰ã‚“",temp:"å†·é…’"},
  {name:"ãƒ­ä¸‡ ç´”ç±³åŸé†¸ï¼ˆèŠ±æ³‰é…’é€ ï¼‰",note:"æœ€å¾Œã®èŠ±ç«",temp:"å†·é…’"},
  {name:"äººæ°—ä¸€ ã‚ã‚ ã‚·ãƒ£ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥ï¼ˆäººæ°—é…’é€ ï¼‰",note:"æ³¡ã§é£›ã¹ã€‚æˆ»ã£ã¦ãã‚‹ãª",temp:"å†·é…’"},
  {name:"ã«ã„ã ã—ãœã‚“ã—ã‚… åŸé…’ï¼ˆä»äº•ç”°æœ¬å®¶ï¼‰",note:"-15ã€‚ç”˜æ—¨ã®æ²¼ã«è½ã¡ã‚",temp:"å†·é…’"},
  {name:"é£›éœ²å–œ é»’ãƒ©ãƒ™ãƒ«ï¼ˆå»£æœ¨é…’é€ æœ¬åº—ï¼‰",note:"å‡ºä¼šãˆãŸãªã‚‰é£²ã‚€ã—ã‹ãªã„",temp:"å†·é…’"},
  {name:"è”µå¤ªé¼“+10ï¼ˆå–œå¤šã®è¯é…’é€ å ´ï¼‰",note:"è¶…è¾›å£ã€‚æœ€å¾Œã®ä¸€æ’ƒ",temp:"å†·é…’"},
  {name:"å»£æˆ¸å· ç„¡æ¿¾éç”ŸåŸé…’ï¼ˆæ¾å´é…’é€ ï¼‰",note:"æš´åŠ›çš„æ—¨å‘³ã€‚é–‹ãç›´ã‚Œ",temp:"å†·é…’"},
]};

const LEVELS=[
  {min:0,max:19,label:"ç´ é¢",emoji:"ğŸ˜",cls:"lv0",clr:"var(--cyan)"},
  {min:20,max:39,label:"ã»ã‚é…”ã„",emoji:"ğŸ˜Š",cls:"lv1",clr:"var(--green)"},
  {min:40,max:59,label:"ä¸Šæ©Ÿå«Œ",emoji:"ğŸ¥³",cls:"lv2",clr:"var(--yellow)"},
  {min:60,max:79,label:"å±é™ºåŸŸ",emoji:"ğŸ« ",cls:"lv3",clr:"var(--orange)"},
  {min:80,max:100,label:"ä¼èª¬åŸŸ",emoji:"ğŸ’€",cls:"lv4",clr:"var(--red3)"}
];

const TEXTS={
sing:{
  status:[
    ["ã‚·ãƒ©ãƒ•ã™ãã¦éŸ³ç¨‹ãŒæ­£ç¢ºã€‚ã¤ã¾ã‚‰ã‚“ã€‚","å£°ãŒå®‰å®šã—ã™ãã€‚ã‚«ãƒ©ã‚ªã‚±ã®æ¡ç‚¹ãƒã‚·ãƒ³ã‹ã€‚"],
    ["å£°ãŒæºã‚Œå§‹ã‚ãŸã€‚ã»ã‚é…”ã„ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ã€‚","éŸ³ç¨‹ãŒã‚ºãƒ¬ã¦ããŸã€‚ã§ã‚‚ãã‚ŒãŒå‘³ã€‚"],
    ["å®Œå…¨ã«ãƒãƒªãƒãƒªã€‚æ­Œè©5å‰²é©å½“ã ã‚ã€‚","ä½•ã®æ›²ã‹ã‚ã‹ã‚‰ã‚“ãŒæ¥½ã—ãã†ã€‚","å£°é‡ã ã‘ã¯ç«‹æ´¾ã€‚è¿‘æ‰€è¿·æƒ‘ã€‚"],
    ["æ­Œã˜ã‚ƒãªãã¦å«ã³ã€‚é…æ…®ã‚¼ãƒ­ã€‚","éŸ³ç¨‹ã¨ã„ã†æ¦‚å¿µãŒæ¶ˆæ»…ã€‚è‡ªç”±ã™ãã‚‹ã€‚","ã‚‚ã¯ã‚„å‘ªæ–‡ã€‚ä½•èªï¼Ÿ"],
    ["ä¼èª¬ã®ãƒªã‚µã‚¤ã‚¿ãƒ«ã€‚éŒ²éŸ³ã•ã‚Œã¦ãªã„ã“ã¨ã‚’ç¥ˆã‚Œã€‚","ã“ã‚Œã‚’æ­Œã¨å‘¼ã‚“ã§ã„ã„ã®ã‹å­¦ä¼šã§è­°è«–ãŒå¿…è¦ã€‚","ãƒãƒ¼ãƒ³ã€‚é­‚ã®å«ã³ã ã£ãŸã€‚"]
  ],prophecy:[
    ["æ˜æ—¥ï¼šã®ã©ãŒæ¯ã‚Œã¦ã„ã‚‹ã€‚","æ˜æ—¥ï¼šæ­Œã£ã¦ãŸå‹•ç”»ãŒã‚°ãƒ«ãƒ¼ãƒ—LINEã«ã€‚"],
    ["æ˜æ—¥ï¼šè„³å†…ã§ã‚µãƒ“ãŒãƒªãƒ”ãƒ¼ãƒˆã€‚","æ˜æ—¥ï¼šã‚«ãƒ©ã‚ªã‚±ã®æ¡ç‚¹ã‚’æ€ã„å‡ºã—ã¦èµ¤é¢ã€‚"],
    ["æ˜æ—¥ï¼šå£°ãŒã‚¬ãƒ©ã‚¬ãƒ©ã€‚é¢¨é‚ªã ã¨å˜˜ã¤ãã€‚","æ˜æ—¥ï¼šæ­Œã£ãŸæ›²ã‚’æ¤œç´¢ã—ã¦é©šãã€‚"],
    ["æ˜æ—¥ï¼šåŒåƒšã«ã€Œæ˜¨æ—¥ã™ã”ã‹ã£ãŸã­ã€ã¨è¨€ã‚ã‚Œã‚‹ã€‚","æ˜æ—¥ï¼šã®ã©é£´ã‚’10å€‹æ¶ˆè²»ã€‚"],
    ["æ˜æ—¥ï¼šè¿‘éš£ä½æ°‘ã‹ã‚‰æ‰‹ç´™ãŒå±Šãã€‚","æ˜æ—¥ï¼š3æ—¥é–“ã€å£°ãŒå‡ºãªã„ã€‚ãƒãƒ¼ãƒ³ã€‚"]
  ]
},sexy:{
  status:[
    ["è‰²æ°—ã‚¼ãƒ­ã€‚æ‰‡é¢¨æ©Ÿã®æ–¹ãŒã‚»ã‚¯ã‚·ãƒ¼ã€‚","ãŸã ã®æ¯ã€‚ä½•ã‚‚æ„Ÿã˜ãªã„ã€‚ã‚‚ã£ã¨é…”ãˆã€‚"],
    ["ã¡ã‚‡ã£ã¨ã ã‘è‰²ã£ã½ã‹ã£ãŸã€‚â€¦æ°—ã®ã›ã„ã‹ã‚‚ã€‚","ã»ã‚“ã®ã‚Šè‰²æ°—ã€‚ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ã®åŠ›ã¯å‰å¤§ã€‚"],
    ["ãªã‹ãªã‹ã‚»ã‚¯ã‚·ãƒ¼ã€‚å‘¨ã‚ŠãŒäºŒåº¦è¦‹ã—ã¦ã‚‹ãã€‚","è‰²æ°—ãƒ€ãƒ€æ¼ã‚Œã€‚ãƒ•ã‚§ãƒ­ãƒ¢ãƒ³æ¤œå‡ºã€‚","ã¡ã‚‡ã£ã¨ãƒ‰ã‚­ãƒƒã¨ã—ãŸã€‚"],
    ["å±é™ºãªè‰²æ°—ã€‚åŠå¾„3mæ³¨æ„ã€‚","ã‚»ã‚¯ã‚·ãƒ¼ã™ãã¦é€šå ±ãƒ¬ãƒ™ãƒ«ã€‚è‡ªåˆ¶ã—ã‚ã€‚","ã‚‚ã†ã“ã‚Œäº‹ä»¶ã€‚è‰²æ°—ã®æš´åŠ›ã€‚"],
    ["ä¼èª¬ã®ã‚»ã‚¯ã‚·ãƒ¼ã€‚ç©ºæ°—ãŒå¤‰ã‚ã£ãŸã€‚","è‰²æ°—ã§äººã‚’å€’ã›ã‚‹ãƒ¬ãƒ™ãƒ«ã€‚æ­¦å™¨ã ã‚ã€‚","ãƒãƒ¼ãƒ³ã€‚è‰²ã£ã½ã™ãã¦æˆä»ã—ãŸã€‚"]
  ],prophecy:[
    ["æ˜æ—¥ï¼šä½•äº‹ã‚‚ãªã‹ã£ãŸã‹ã®ã‚ˆã†ã«éã”ã™ã€‚","æ˜æ—¥ï¼šé¡ã‚’è¦‹ã¦ã€Œæ™®é€šã ãªã€ã¨æ€ã†ã€‚"],
    ["æ˜æ—¥ï¼šèª°ã‹ã®å¤¢ã«å‡ºã‚‹ã€‚ãŸã¶ã‚“ã€‚","æ˜æ—¥ï¼šLINEã‚¹ã‚¿ãƒ³ãƒ—ãŒæ€¥ã«ãƒãƒ¼ãƒˆã ã‚‰ã‘ã€‚"],
    ["æ˜æ—¥ï¼šã€Œæ˜¨æ—¥è‰²ã£ã½ã‹ã£ãŸã­ã€ã¨è¨€ã‚ã‚Œã‚‹ã€‚","æ˜æ—¥ï¼šãƒ•ã‚§ãƒ­ãƒ¢ãƒ³ã®æ®‹ã‚Šé¦™ã§ã‚¶ãƒ¯ã¤ãã€‚"],
    ["æ˜æ—¥ï¼šç›®æ’ƒè¨¼è¨€ãŒè¤‡æ•°ã€‚è¨€ã„é€ƒã‚Œä¸å¯ã€‚","æ˜æ—¥ï¼šã€Œã‚ã®æ¯ã®å‹•ç”»ã€ãŒä»²é–“å†…ã§å‡ºå›ã‚‹ã€‚"],
    ["æ˜æ—¥ï¼šä¼èª¬ã¨ã—ã¦èªã‚Šç¶™ãŒã‚Œã‚‹ã€‚","æ˜æ—¥ï¼šè‰²æ°—ã®å¾Œéºç—‡ã§3æ—¥ãƒ¢ãƒ†ã‚‹ã€‚ãƒãƒ¼ãƒ³ã€‚"]
  ]
},long:{
  status:[
    ["æ¯çŸ­ã£ã€‚è‚ºæ´»é‡ãŒé‡‘é­šãƒ¬ãƒ™ãƒ«ã€‚","ã‚‚ã†çµ‚ã‚ã‚Šï¼Ÿå§‹ã¾ã£ãŸã‹ã©ã†ã‹ã‚‚æ€ªã—ã„ã€‚"],
    ["ã¾ã‚ã¾ã‚ã®è‚ºæ´»é‡ã€‚äººé–“ã¨ã—ã¦å¹³å‡çš„ã€‚","ãã“ãã“æŒã£ãŸã€‚å¯ã‚‚ãªãä¸å¯ã‚‚ãªãã€‚"],
    ["ãªã‹ãªã‹ã®æŒä¹…åŠ›ã€‚é…”ã£ã¦ã‚‹å‰²ã«ã‚„ã‚‹ãªã€‚","è‚ºãŒå¼·ã„ã€‚å¹å¥æ¥½éƒ¨ã ã£ãŸã‚ï¼Ÿ","é•·ã„ï¼ã§ã‚‚é¡”çœŸã£èµ¤ã ãã€‚"],
    ["ãƒã‚±ãƒ¢ãƒç´šã®è‚ºæ´»é‡ã€‚ã‚¤ãƒ«ã‚«ã‹ãŠå‰ã¯ã€‚","ã™ã”ã„â€¦é…¸æ¬ ã§å€’ã‚Œã‚‹ãªã‚ˆï¼Ÿ","ã‚‚ã†ååˆ†ã€‚ç”Ÿãã¦ã‚‹ã‹ï¼Ÿ"],
    ["äººé¡ã®é™ç•Œã‚’è¶…ãˆãŸã€‚å‘¼å¸ã®ã‚ªãƒªãƒ³ãƒ”ã‚¢ãƒ³ã€‚","ä¼èª¬ã®è‚ºã€‚åŒ»å­¦çš„ã«èª¿ã¹ã•ã›ã¦ãã‚Œã€‚","ãƒãƒ¼ãƒ³ã€‚æ¯ã®ä»£ã‚ã‚Šã«é­‚ãŒå‡ºãŸã€‚"]
  ],prophecy:[
    ["æ˜æ—¥ï¼šè‚ºãŒä½•äº‹ã‚‚ãªã‹ã£ãŸã‹ã®ã‚ˆã†ã«å‹•ãã€‚","æ˜æ—¥ï¼šæ¯ã®çŸ­ã•ã‚’åçœã—ã¦æ·±å‘¼å¸ã™ã‚‹ã€‚"],
    ["æ˜æ—¥ï¼šãªã‚“ã¨ãªãèƒ¸ã®ã‚ãŸã‚ŠãŒç–²ã‚Œã¦ã‚‹ã€‚","æ˜æ—¥ï¼šã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã§æ¯åˆ‡ã‚Œã™ã‚‹ã€‚"],
    ["æ˜æ—¥ï¼šè‚ºæ´»é‡ã«è‡ªä¿¡ãŒã¤ãã€‚æ ¹æ‹ ãªã—ã€‚","æ˜æ—¥ï¼šè¤’ã‚ã‚‰ã‚Œã‚‹ã€‚è‚ºã‚’ã€‚"],
    ["æ˜æ—¥ï¼šæ·±å‘¼å¸ã™ã‚‹ã ã‘ã§å‘¨ã‚ŠãŒãƒ“ãƒ“ã‚‹ã€‚","æ˜æ—¥ï¼šè‚ºã®MRIæ’®ã‚ŠãŸããªã‚‹ã€‚"],
    ["æ˜æ—¥ï¼šé…¸ç´ ãƒœãƒ³ãƒ™ãŒå±Šãã€‚","æ˜æ—¥ï¼šè‚ºå­¦ä¼šã‹ã‚‰æ‹›å¾…çŠ¶ãŒå±Šãã€‚ãƒãƒ¼ãƒ³ã€‚"]
  ]
}};

const YOISHO_MODE={
sing:[
  {emoji:"ğŸ¤",text:"ãŠã£ï¼\nãªã‹ãªã‹ã„ã„å£°ï¼"},
  {emoji:"ğŸµ",text:"å£°é‡ã™ã”ã„ï¼\nãƒã‚¤ã‚¯ãŒéœ‡ãˆã¦ã‚‹ï¼"},
  {emoji:"ğŸ¶",text:"ã„ã„æ­Œã ï¼\nâ€¦ãŸã¶ã‚“ï¼"},
  {emoji:"ğŸ˜‚",text:"éŸ³ç¨‹ãŒè‡ªç”±ã™ãã¦\nAIå›°æƒ‘ä¸­ï½—"},
  {emoji:"ğŸ”Š",text:"ã†ã‚‹ã•ã„ï¼\nâ€¦è¤’ã‚ã¦ã¾ã™ï¼"},
  {emoji:"ğŸ‘",text:"ãƒ–ãƒ©ãƒœãƒ¼ï¼\nâ€¦ä½•ã®æ›²ï¼Ÿ"},
  {emoji:"ğŸ¼",text:"æ–°ã‚¸ãƒ£ãƒ³ãƒ«èª•ç”Ÿï¼\né…”æ‹³ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ï¼"},
],sexy:[
  {emoji:"ğŸ’‹",text:"ãŠã‰â€¦\nã¡ã‚‡ã£ã¨ãƒ‰ã‚­ãƒƒã¨ã—ãŸ"},
  {emoji:"ğŸ«¦",text:"ãªã‹ãªã‹\nã‚»ã‚¯ã‚·ãƒ¼ã˜ã‚ƒã‚“â€¦ï¼"},
  {emoji:"ğŸ’•",text:"è‰²æ°—æ¤œå‡ºï¼\nãƒ•ã‚§ãƒ­ãƒ¢ãƒ³ã‚»ãƒ³ã‚µãƒ¼åå¿œï¼"},
  {emoji:"ğŸ”¥",text:"ã‚ã£ã¤ï¼\næ¯ãŒç†±ã„ï¼"},
  {emoji:"ğŸ˜³",text:"ãˆã£â€¦\nãã‚Œã¯ã¡ã‚‡ã£ã¨â€¦åå‰‡â€¦"},
  {emoji:"âœ¨",text:"ã‚­ãƒ©ã‚­ãƒ©ã—ã¦ã‚‹ï¼\nãŠå‰ã®æ¯ã€è¼ã„ã¦ã‚‹ï¼"},
  {emoji:"ğŸ«¡",text:"äº†è§£ï¼\nã‚»ã‚¯ã‚·ãƒ¼ãƒ‡ãƒ¼ã‚¿å—ä¿¡ï¼"},
],long:[
  {emoji:"ğŸ«",text:"ãŠãƒ¼ï¼\nã¾ã ç¶šã„ã¦ã‚‹ï¼"},
  {emoji:"ğŸ’ª",text:"è‚ºæ´»é‡ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ï¼\nã¾ã ã„ã‘ã‚‹ï¼"},
  {emoji:"ğŸ˜¤",text:"ã™ã”ã„ï¼\né¡”çœŸã£èµ¤ã ãï¼"},
  {emoji:"ğŸ‹",text:"ã‚¯ã‚¸ãƒ©ã‹ãªï¼Ÿ\næ·±æµ·ã¾ã§æ½œã‚Œãã†ï¼"},
  {emoji:"âš¡",text:"ã¾ã æ­¢ã¾ã‚‰ãªã„ï¼\näººé–“ã‚„ã‚ã¦ã‚‹ï¼"},
  {emoji:"ğŸ†",text:"è¨˜éŒ²æ›´æ–°ä¸­ï¼\nã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯ç´šï¼"},
  {emoji:"ğŸ˜µ",text:"ã‚‚ã†ã„ã„ï¼\nå€’ã‚Œã‚‹ãï¼"},
]};

const KING=[
  "ä»Šå¤œã€ã“ã“ã§æ­¢ã¾ã‚Œã€‚","ãŠå‰ã¯ã¾ã ç«‹ã£ã¦ã„ã‚‹ã€‚ãã‚Œã ã‘ã§ç‹ã ã€‚","é£²ã‚ã€‚ã ãŒå¸°ã‚Šé“ã‚’å¿˜ã‚Œã‚‹ãªã€‚",
  "é…”ã„ã¯å˜˜ã‚’ã¤ã‹ãªã„ã€‚","ã¾ã é£²ã‚€ã®ã‹ã€‚â€¦å«Œã„ã˜ã‚ƒãªã„ã€‚","ãŠå‰ã®è‚è‡“ãŒæ³£ã„ã¦ã„ã‚‹ã€‚",
  "æ­¢ã‚æ™‚ã‚’çŸ¥ã‚‹è€…ãŒçœŸã®ç‹ã ã€‚","ãƒãƒ¼ãƒ³ã€‚ã ãŒç”Ÿãã¦ã„ã‚‹ã€‚ãã‚Œã§ã„ã„ã€‚",
  "ã‚ˆãã‚„ã£ãŸã€‚ã ãŒäºŒåº¦ã¨ã‚„ã‚‹ãªã€‚","ä»Šå¤œã®ãŠå‰ã¯ã€ã¡ã‚‡ã£ã¨é¢ç™½ã„ã€‚"
];

let mode='',audioCtx,analyser,micStream,measuring=false;
let volumes=[],startTime=0,animFrame=0,canvas,ctx,cW,cH;
let measureDuration=2;

function show(id){
  document.querySelectorAll('.sc').forEach(s=>s.classList.remove('on'));
  setTimeout(()=>{
    document.getElementById(id).classList.add('on');
    if(id==='s-mode') updateModeUI();
  },60);
}
function rp(a){return a[Math.floor(Math.random()*a.length)]}

// === MODE SELECT ===
async function selectMode(m){
  if(m==='manual'){mode='long';show('s-manual');return}
  // Check premium
  if((m==='sing'||m==='long') && !isPaid()){
    window.location.href = PAYMENT_URL;
    return;
  }
  mode=m;
  measureDuration=m==='sing'?10:m==='sexy'?3:20;
  // â˜… iPhone Safariå¯¾ç­–: ã‚¿ãƒƒãƒ—ç›´å¾Œã«ãƒã‚¤ã‚¯è¨±å¯ã‚’å–ã‚‹
  try{
    micStream=await navigator.mediaDevices.getUserMedia({audio:true});
    audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    const src=audioCtx.createMediaStreamSource(micStream);
    analyser=audioCtx.createAnalyser();analyser.fftSize=512;analyser.smoothingTimeConstant=0.3;
    src.connect(analyser);
    beginCountdown(true);
  }catch(e){
    // ãƒã‚¤ã‚¯å–ã‚Œãªã‹ã£ãŸ â†’ æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰
    mode='long';show('s-manual');
  }
}

function beginCountdown(micReady){
  show('s-cd');
  const subs={sing:'æ­Œã®æº–å‚™ã¯ã„ã„ã‹â€¦ï¼Ÿ',sexy:'å¿ƒã®æº–å‚™ã¯ã„ã„ã‹â€¦ï¼Ÿ',long:'æ·±å‘¼å¸ã—ã¦ãŠã‘â€¦'};
  document.getElementById('cdSub').textContent=subs[mode]||'æº–å‚™ã—ã¦â€¦';
  const el=document.getElementById('cdNum');
  let c=3;el.textContent=c;el.className='cd-num';void el.offsetWidth;el.classList.add('pop');
  const iv=setInterval(()=>{c--;
    if(c>0){el.className='cd-num';el.textContent=c;void el.offsetWidth;el.classList.add('pop')}
    else{clearInterval(iv);const starts={sing:'ğŸ¤',sexy:'ğŸ’‹',long:'ğŸ’¨'};
      el.className='cd-num';el.textContent=starts[mode]||'ğŸ’¨';void el.offsetWidth;el.classList.add('pop');
      setTimeout(()=>startMeasure(micReady),400)}
  },900);
}

function startMeasure(micReady){
  canvas=document.getElementById('noiseCanvas');
  const r=canvas.getBoundingClientRect();canvas.width=r.width*2;canvas.height=r.height*2;
  ctx=canvas.getContext('2d');cW=canvas.width;cH=canvas.height;ctx.scale(2,2);
  const titles={sing:'ğŸ¤ æ­Œãˆï¼å…¨åŠ›ã§ï¼',sexy:'ğŸ’‹ ã‚»ã‚¯ã‚·ãƒ¼ã«å¹ã‘ï¼',long:'ğŸ« é™ç•Œã¾ã§å¹ã‘ï¼'};
  const labels={sing:'10ç§’é–“æ­Œã£ã¦æ¸¬å®š',sexy:'3ç§’é–“ è‰²ã£ã½ã ãƒ•ã‚¥ã€œãƒƒâ™¡',long:'æ¯åˆ‡ã‚Œã™ã‚‹ã¾ã§ï¼æœ€å¤§20ç§’'};
  document.getElementById('mTitle').textContent=titles[mode];
  document.getElementById('mLabel').textContent=labels[mode];
  document.getElementById('gaugeNum').textContent='0';
  document.getElementById('gaugeFill').style.width='0%';
  show('s-measure');
  if(micReady && analyser){
    // ãƒã‚¤ã‚¯ã¯æ—¢ã«å–å¾—æ¸ˆã¿ â†’ ã™ãæ¸¬å®šé–‹å§‹
    volumes=[];measuring=true;startTime=performance.now();mLoop();
  }else{
    mode='long';show('s-manual');
  }
}

function mLoop(){
  if(!measuring)return;
  const elapsed=(performance.now()-startTime)/1000;
  const data=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(data);
  let sum=0;for(let i=0;i<data.length;i++)sum+=data[i]*data[i];
  const rms=Math.sqrt(sum/data.length);const vol=Math.min(100,rms/1.2);
  volumes.push(vol);
  const avg=volumes.reduce((a,b)=>a+b,0)/volumes.length;
  updateGauge(Math.min(100,Math.round(avg*1.1+Math.random()*6)));
  if(mode==='long'){
    document.getElementById('timerText').textContent=`${elapsed.toFixed(1)} ç§’çµŒé`;
    if(volumes.length>30){const tail=volumes.slice(-30);const tavg=tail.reduce((a,b)=>a+b,0)/30;
      if(tavg<3&&elapsed>2){measuring=false;stopMic();finishMeasure();return}}
    if(elapsed>=20){measuring=false;stopMic();finishMeasure();return}
  }else{
    document.getElementById('timerText').textContent=`æ®‹ã‚Š ${Math.max(0,measureDuration-elapsed).toFixed(1)} ç§’`;
    if(elapsed>=measureDuration){measuring=false;stopMic();finishMeasure();return}
  }
  drawNoise(vol,data);animFrame=requestAnimationFrame(mLoop);
}

function updateGauge(v){
  v=Math.max(0,Math.min(100,v));
  document.getElementById('gaugeNum').textContent=Math.round(v);
  document.getElementById('gaugeFill').style.width=v+'%';
  let c;if(v<20)c='var(--cyan)';else if(v<40)c='var(--green)';
  else if(v<60)c='var(--yellow)';else if(v<80)c='var(--orange)';else c='var(--red3)';
  document.getElementById('gaugeFill').style.background=`linear-gradient(90deg,${c},${c}dd)`;
  document.getElementById('gaugeNum').style.color=c;
}
function drawNoise(vol,data){
  const w=cW/2,h=cH/2;ctx.fillStyle='rgba(5,5,8,0.3)';ctx.fillRect(0,0,w,h);
  const bW=w/data.length*2;
  for(let i=0;i<data.length;i+=2){const v=data[i]/255;
    ctx.fillStyle=`hsla(${120-v*120},70%,50%,${0.3+v*0.5})`;ctx.fillRect(i/2*bW,h-v*h*0.8,bW-1,v*h*0.8)}
  ctx.beginPath();ctx.strokeStyle=`rgba(201,168,76,${0.2+vol/200})`;ctx.lineWidth=1.5;
  for(let x=0;x<w;x++){const idx=Math.floor(x/w*data.length);
    const y=h/2+(data[idx]/255-0.5)*h*0.6+Math.sin(x*0.05+performance.now()*0.003)*vol*0.15;
    x===0?ctx.moveTo(x,y):ctx.lineTo(x,y)}ctx.stroke();
}
function stopMic(){if(micStream)micStream.getTracks().forEach(t=>t.stop());if(audioCtx)audioCtx.close().catch(()=>{});cancelAnimationFrame(animFrame)}
function cancelMeasure(){measuring=false;stopMic();show('s-intro')}
function stopEarly(){measuring=false;stopMic();finishMeasure()}
function manualGo(){doAnalyze(parseInt(document.getElementById('manualRange').value))}

function finishMeasure(){
  if(!volumes.length){doAnalyze(50);return}
  const avg=volumes.reduce((a,b)=>a+b,0)/volumes.length;
  const vari=volumes.reduce((a,b)=>a+(b-avg)**2,0)/volumes.length;
  let base=Math.min(80,avg*1.1);
  if(mode==='long'){const dur=(performance.now()-startTime)/1000;base+=Math.min(20,dur*1.5)}
  let score=Math.round(base+Math.min(15,Math.sqrt(vari)*0.8)+(Math.random()-0.5)*18);
  doAnalyze(Math.max(0,Math.min(100,score)));
}

function doAnalyze(score){
  show('s-analyze');
  const yList=YOISHO_MODE[mode]||YOISHO_MODE.sexy;
  const picks=[];const used=new Set();
  while(picks.length<3){const i=Math.floor(Math.random()*yList.length);if(!used.has(i)){used.add(i);picks.push(yList[i])}}
  let yi=0;
  document.getElementById('azEmoji').textContent=picks[0].emoji;
  document.getElementById('azText').innerHTML=picks[0].text.replace(/\n/g,'<br>');
  const iv=setInterval(()=>{yi++;if(yi<picks.length){
    document.getElementById('azEmoji').textContent=picks[yi].emoji;
    document.getElementById('azText').innerHTML=picks[yi].text.replace(/\n/g,'<br>')}},1000);
  setTimeout(()=>{clearInterval(iv);renderResult(score)},3200);
}

function fireConfetti(){
  const box=document.getElementById('confettiBox');box.innerHTML='';
  const colors=['#e8c960','#e05028','#40c0d0','#30a050','#e0c030','#d060a0','#ff4040','#8040c0','#fff'];
  for(let i=0;i<80;i++){const c=document.createElement('div');c.className='confetti';const sz=4+Math.random()*10;
    c.style.cssText=`left:${Math.random()*100}%;top:-10px;width:${sz}px;height:${sz}px;background:${rp(colors)};border-radius:${Math.random()>0.5?'50%':'2px'};--dur:${1.5+Math.random()*2.5}s;--del:${Math.random()*0.8}s`;
    box.appendChild(c)}setTimeout(()=>box.innerHTML='',5000)}
function flashScreen(){const f=document.getElementById('flash');f.classList.add('bang');setTimeout(()=>{f.classList.remove('bang');f.style.opacity='0'},80)}

function renderResult(score){
  const li=score<20?0:score<40?1:score<60?2:score<80?3:4;
  const lv=LEVELS[li];
  const modeTexts=TEXTS[mode]||TEXTS.sexy;
  const status=rp(modeTexts.status[li]);
  const prophecy=rp(modeTexts.prophecy[li]);
  const bs=rp(SAKE.brake),cs=rp(SAKE.calm),ys=rp(SAKE.yolo);
  const showK=Math.random()<0.2;const kw=rp(KING);
  const badges={sing:'badge-sing',sexy:'badge-sexy',long:'badge-long'};
  const badgeNames={sing:'ğŸ¤ æ­Œã£ã¦æ¸¬å®š',sexy:'ğŸ’‹ è‰²ã£ã½ãæ¸¬å®š',long:'ğŸ« ãƒ­ãƒ³ã‚°ãƒ¬ãƒ³ã‚¸'};

  document.getElementById('s-result').innerHTML=`
    <div class="res-emoji2 dramatic">${lv.emoji}</div>
    <div class="res-label ${lv.cls} slideIn">${lv.label}</div>
    <div class="res-num-wrap">
      <div class="res-glow" style="background:${lv.clr}"></div>
      <div class="res-num ${lv.cls} countUp" id="resN" data-target="${score}">0</div>
    </div>
    <div class="res-unit fadeIn">ãƒ™ãƒ­</div>
    <div class="res-mode-badge ${badges[mode]||'badge-sexy'} fadeIn">${badgeNames[mode]||'ğŸ’‹'}</div>
    <div class="res-box fi d4">
      <div class="res-box-title">â–¶ ä»Šå¤œã®ã‚ãªãŸ</div>
      <div class="res-box-text">${status.replace(/\n/g,'<br>')}</div>
    </div>
    <div class="res-prophecy fi d5">
      <div class="res-prophecy-title">ğŸ”® æ˜æ—¥ã®äºˆè¨€</div>
      <div class="res-prophecy-text">${prophecy}</div>
    </div>
    <div class="sake-box fi d6">
      <div class="sake-title">ğŸ¶ ä»Šå¤œã®ãŠã™ã™ã‚æ—¥æœ¬é…’</div>
      <div class="sake-card"><div class="sake-role brake">ğŸ›‘ ãƒ–ãƒ¬ãƒ¼ã‚­é…’ â€• ã“ã‚Œä»¥ä¸Šã„ããª</div><div class="sake-name">${bs.name}</div><div class="sake-note">${bs.note}ï½œ${bs.temp}</div></div>
      <div class="sake-card"><div class="sake-role calm">ğŸµ æ•´ãˆã‚‹é…’ â€• è½ã¡ç€ã‘</div><div class="sake-name">${cs.name}</div><div class="sake-note">${cs.note}ï½œ${cs.temp}</div></div>
      <div class="sake-card"><div class="sake-role yolo">ğŸ”¥ é–‹ãç›´ã‚Šé…’ â€• ã‚‚ã†çŸ¥ã‚‰ã‚“</div><div class="sake-name">${ys.name}</div><div class="sake-note">${ys.note}ï½œ${ys.temp}</div></div>
    </div>
    <div class="king-box fi d7 ${showK?'show':''}"><div class="king-label">ä¸–ç•Œç‹ã®åˆ¤å®š</div><div class="king-text">ã€Œ${kw}ã€</div></div>
    <button class="retry-btn fi d8" onclick="retry()">ğŸ”„ ã‚‚ã†ä¸€å›æ¸¬ã‚‹</button>
    <div class="ft fi d9">Presented by ä¸–ç•Œç‹ / <a href="https://hideo-t.github.io/negaibi/" style="color:var(--gold2)">é¡˜ã„ç¯</a><br><a href="https://hideo-t.github.io/negaibi/#tokushoho" style="color:var(--gold2)">ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜</a></div>
  `;
  flashScreen();fireConfetti();show('s-result');
  setTimeout(()=>{document.getElementById('s-result').classList.add('shaking');setTimeout(()=>document.getElementById('s-result').classList.remove('shaking'),600)},100);
  setTimeout(()=>{const n=document.getElementById('resN');if(!n)return;const t=parseInt(n.dataset.target);let c=0;const s=Math.max(1,Math.floor(t/30));
    const iv=setInterval(()=>{c+=s;if(c>=t){c=t;clearInterval(iv)}n.textContent=c},30)},600);
}

function retry(){document.getElementById('s-result').scrollTo(0,0);show('s-intro')}
</script>
</body>
</html>
