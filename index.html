<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ãƒ™ãƒ­ãƒ¡ãƒ¼ã‚¿ãƒ¼ by ä¸–ç•Œç‹</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Zen+Old+Mincho:wght@400;700;900&family=Shippori+Mincho:wght@400;600;800&family=Noto+Sans+JP:wght@300;500;700;900&display=swap');

:root{
  --bg:#050508;--bg2:#0a0a12;
  --gold:#c9a84c;--gold2:#8a6e30;--gold3:#e8c960;
  --wht:#e0dcd0;--grey:#444460;
  --red:#d03030;--red2:#801818;--red3:#ff4040;
  --green:#30a050;--green2:#186028;
  --cyan:#40c0d0;--yellow:#e0c030;--orange:#e08030;--pink:#d060a0;
  --purple:#8040c0;
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;background:var(--bg);color:var(--wht);font-family:'Noto Sans JP',sans-serif;overflow:hidden;-webkit-tap-highlight-color:transparent;user-select:none}

/* GRAIN */
body::after{content:'';position:fixed;inset:0;background:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;mix-blend-mode:overlay}

/* SCREENS */
.sc{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;opacity:0;transform:scale(0.97);transition:opacity 0.7s,transform 0.7s;pointer-events:none;z-index:1}
.sc.on{opacity:1;transform:scale(1);pointer-events:auto}
.sc.scroll{overflow-y:auto;justify-content:flex-start;padding-top:max(24px,3vh);padding-bottom:60px}

/* INTRO */
.intro-icon{font-size:72px;margin-bottom:8px;animation:bounce 2s ease-in-out infinite}
@keyframes bounce{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-12px) scale(1.05)}}

.app-title{font-family:'Zen Old Mincho',serif;font-size:clamp(48px,12vw,72px);font-weight:900;background:linear-gradient(135deg,var(--gold3),var(--orange),var(--red3));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center;line-height:1.1;letter-spacing:0.05em}
.app-sub{font-size:clamp(13px,3.2vw,16px);color:var(--grey);letter-spacing:0.2em;margin-top:4px}
.app-desc{font-size:clamp(14px,3.5vw,17px);color:var(--wht);text-align:center;margin-top:20px;line-height:1.8;max-width:360px;opacity:0.7}
.app-desc em{color:var(--gold3);font-style:normal;font-weight:700}

.big-btn{margin-top:28px;width:min(320px,80vw);padding:20px 0;background:linear-gradient(135deg,var(--red2),var(--red));border:none;border-radius:8px;color:#fff;font-family:'Zen Old Mincho',serif;font-size:clamp(22px,5.5vw,28px);font-weight:700;letter-spacing:0.2em;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 20px rgba(208,48,48,0.3)}
.big-btn:active{transform:scale(0.96);box-shadow:0 2px 10px rgba(208,48,48,0.2)}

.privacy-note{font-size:clamp(9px,2.3vw,11px);color:var(--grey);margin-top:16px;opacity:0.5;text-align:center}

/* MEASURE */
.measure-title{font-family:'Zen Old Mincho',serif;font-size:clamp(24px,6vw,32px);font-weight:700;margin-bottom:16px;text-align:center}
.measure-inst{font-size:clamp(16px,4vw,20px);color:var(--gold);text-align:center;margin-bottom:20px;letter-spacing:0.1em}

/* CANVAS */
#noiseCanvas{width:min(380px,90vw);height:120px;border:1px solid rgba(201,168,76,0.15);border-radius:6px;background:var(--bg2);margin-bottom:16px}

/* GAUGE BAR */
.gauge-wrap{width:min(380px,90vw);height:40px;background:var(--bg2);border:1px solid rgba(201,168,76,0.15);border-radius:20px;overflow:hidden;position:relative;margin-bottom:12px}
.gauge-fill{height:100%;border-radius:20px;transition:width 0.1s;position:relative;overflow:hidden}
.gauge-fill::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.1),transparent);animation:shimmer 1.5s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}

.gauge-num{font-family:'Zen Old Mincho',serif;font-size:clamp(48px,12vw,72px);font-weight:900;text-align:center;margin-bottom:8px;transition:color 0.3s}

.timer-text{font-size:clamp(14px,3.5vw,17px);color:var(--grey);text-align:center;margin-bottom:16px}

.stop-btn{padding:14px 40px;background:rgba(100,100,120,0.2);border:1px solid var(--grey);border-radius:6px;color:var(--grey);font-size:clamp(16px,4vw,18px);cursor:pointer;transition:all 0.3s}
.stop-btn:active{background:rgba(100,100,120,0.4)}

/* MANUAL MODE */
.manual-box{width:min(380px,90vw);text-align:center;margin-top:16px}
.manual-link{font-size:clamp(12px,3vw,14px);color:var(--gold2);text-decoration:underline;cursor:pointer}
.manual-slider-wrap{margin-top:12px;display:none}
.manual-slider-wrap.show{display:block}
.manual-label{font-size:clamp(14px,3.5vw,16px);color:var(--wht);margin-bottom:8px}
input[type=range]{width:100%;height:40px;-webkit-appearance:none;background:transparent;margin-bottom:12px}
input[type=range]::-webkit-slider-runnable-track{height:8px;background:linear-gradient(90deg,var(--green),var(--yellow),var(--orange),var(--red));border-radius:4px}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:32px;height:32px;background:var(--gold);border-radius:50%;margin-top:-12px;box-shadow:0 2px 8px rgba(0,0,0,0.4)}
.manual-go{padding:14px 40px;background:var(--red);border:none;border-radius:6px;color:#fff;font-size:clamp(18px,4.5vw,22px);font-weight:700;cursor:pointer;letter-spacing:0.1em}

/* LOADING */
.ld-icon{font-size:64px;animation:spin 1s linear infinite;margin-bottom:16px}
@keyframes spin{to{transform:rotate(360deg)}}
.ld-text{font-size:clamp(16px,4vw,20px);color:var(--gold2);animation:pulse 1.5s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:0.3}50%{opacity:1}}

/* RESULT */
.res-emoji{font-size:64px;margin-bottom:8px;animation:resB 2s ease-in-out infinite}
@keyframes resB{0%,100%{transform:scale(1) rotate(0)}25%{transform:scale(1.1) rotate(-5deg)}75%{transform:scale(1.1) rotate(5deg)}}

.res-level{font-family:'Zen Old Mincho',serif;font-size:clamp(36px,9vw,52px);font-weight:900;text-align:center;margin-bottom:4px}
.res-label{font-size:clamp(20px,5vw,28px);font-weight:700;text-align:center;margin-bottom:16px;letter-spacing:0.15em}

.res-num{font-family:'Zen Old Mincho',serif;font-size:clamp(80px,20vw,120px);font-weight:900;text-align:center;line-height:1}
.res-unit{font-size:clamp(14px,3.5vw,18px);color:var(--grey);text-align:center;margin-bottom:20px}

.res-status{width:min(380px,90vw);background:rgba(255,255,255,0.03);border:1px solid rgba(201,168,76,0.1);border-radius:6px;padding:16px 20px;margin-bottom:14px;text-align:center}
.res-status-title{font-size:clamp(11px,2.8vw,13px);color:var(--gold);letter-spacing:0.3em;margin-bottom:8px}
.res-status-text{font-size:clamp(16px,4vw,20px);line-height:1.9}

.res-prophecy{width:min(380px,90vw);background:rgba(100,30,100,0.08);border:1px solid rgba(128,64,192,0.15);border-radius:6px;padding:16px 20px;margin-bottom:14px;text-align:center}
.res-prophecy-title{font-size:clamp(11px,2.8vw,13px);color:var(--purple);letter-spacing:0.3em;margin-bottom:8px}
.res-prophecy-text{font-size:clamp(15px,3.8vw,19px);color:rgba(200,180,220,0.85);line-height:1.8}

/* SAKE RECS */
.sake-box{width:min(380px,90vw);margin-bottom:14px}
.sake-title{font-family:'Zen Old Mincho',serif;font-size:clamp(13px,3.2vw,15px);color:var(--gold);letter-spacing:0.15em;margin-bottom:10px}
.sake-card{background:rgba(255,255,255,0.02);border:1px solid rgba(201,168,76,0.1);border-radius:5px;padding:12px 14px;margin-bottom:8px}
.sake-role{font-size:clamp(10px,2.5vw,12px);letter-spacing:0.2em;margin-bottom:4px;font-weight:700}
.sake-role.brake{color:var(--cyan)}
.sake-role.calm{color:var(--green)}
.sake-role.yolo{color:var(--red3)}
.sake-name{font-size:clamp(14px,3.5vw,17px);font-weight:700;margin-bottom:2px}
.sake-note{font-size:clamp(10px,2.5vw,12px);color:var(--grey);line-height:1.5}

/* KING */
.king-box{width:min(380px,90vw);border-top:1px solid rgba(160,40,40,0.15);padding-top:12px;margin-bottom:14px;text-align:center;display:none}
.king-box.show{display:block}
.king-label{font-size:clamp(9px,2.3vw,11px);color:var(--red2);letter-spacing:0.3em;margin-bottom:4px}
.king-text{font-family:'Zen Old Mincho',serif;font-size:clamp(14px,3.5vw,17px);color:var(--gold);line-height:1.8}

.retry-btn{margin-top:8px;width:min(320px,80vw);padding:18px 0;background:linear-gradient(135deg,rgba(201,168,76,0.1),rgba(201,168,76,0.05));border:1px solid var(--gold2);border-radius:8px;color:var(--gold);font-family:'Zen Old Mincho',serif;font-size:clamp(18px,4.5vw,22px);letter-spacing:0.2em;cursor:pointer;transition:all 0.3s}
.retry-btn:active{transform:scale(0.96)}

.ft{margin-top:16px;text-align:center;opacity:0.2;font-size:9px;color:var(--grey);letter-spacing:0.1em;line-height:2}

/* ANIMATIONS */
.fi{animation:fu 0.8s ease both}
@keyframes fu{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
.d1{animation-delay:.1s;opacity:0}.d2{animation-delay:.25s;opacity:0}.d3{animation-delay:.4s;opacity:0}
.d4{animation-delay:.55s;opacity:0}.d5{animation-delay:.7s;opacity:0}.d6{animation-delay:.85s;opacity:0}
.d7{animation-delay:1s;opacity:0}.d8{animation-delay:1.15s;opacity:0}.d9{animation-delay:1.3s;opacity:0}
.d10{animation-delay:1.45s;opacity:0}

/* Level colors */
.lv-sober{color:var(--cyan)}.lv-tipsy{color:var(--green)}.lv-happy{color:var(--yellow)}
.lv-danger{color:var(--orange)}.lv-legend{color:var(--red3)}
</style>
</head>
<body>

<!-- INTRO -->
<div class="sc on" id="s-intro">
  <div class="intro-icon">ğŸº</div>
  <div class="app-title">ãƒ™ãƒ­<br>ãƒ¡ãƒ¼ã‚¿ãƒ¼</div>
  <div class="app-sub">BERO METER</div>
  <div class="app-desc">ã‚¹ãƒãƒ›ã«<em>2ç§’ãƒ•ãƒ¼ãƒƒ</em>ã¨æ¯ã‚’å¹ãã‹ã‘ã‚‹ã ã‘ã€‚<br>ã‚ãªãŸã®<em>é…”ã„åº¦</em>ã‚’æš´ãã¾ã™ã€‚</div>
  <button class="big-btn" onclick="startMeasure()">ğŸŒ¬ æ¸¬å®šé–‹å§‹</button>
  <div class="privacy-note">ğŸ”’ éŸ³å£°ã¯ä¿å­˜ã—ã¾ã›ã‚“ï¼ˆæ¼”å‡ºç”¨ï¼‰</div>
  <div class="ft" style="margin-top:24px">Presented by ä¸–ç•Œç‹<br>ã€Œã™ã¹ã¦ã®äººã¯ã€è‡ªåˆ†ã®å¤œã®ç‹ã§ã‚ã‚‹ã€‚ã€</div>
</div>

<!-- MEASURE -->
<div class="sc" id="s-measure">
  <div class="measure-title" id="mTitle">ğŸŒ¬ ãƒ•ãƒ¼ãƒƒã¨å¹ã„ã¦ï¼</div>
  <div class="measure-inst" id="mInst">ã‚¹ãƒãƒ›ã®ä¸‹ã«å‘ã‹ã£ã¦æ¯ã‚’å¹ãã‹ã‘ã¦ãã ã•ã„</div>
  <canvas id="noiseCanvas"></canvas>
  <div class="gauge-num" id="gaugeNum">0</div>
  <div class="gauge-wrap"><div class="gauge-fill" id="gaugeFill" style="width:0%;background:var(--cyan)"></div></div>
  <div class="timer-text" id="timerText">æ®‹ã‚Š 2.0 ç§’</div>
  <button class="stop-btn" onclick="cancelMeasure()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  <div class="manual-box" id="manualBox">
    <div class="manual-link" onclick="showManual()">ãƒã‚¤ã‚¯ãŒä½¿ãˆãªã„å ´åˆã¯ã“ã¡ã‚‰</div>
    <div class="manual-slider-wrap" id="manualSlider">
      <div class="manual-label">æ¯ã®å¼·ã•ã‚’é¸ã‚“ã§ãã ã•ã„</div>
      <input type="range" min="0" max="100" value="50" id="manualRange" oninput="updateManualLabel()">
      <div id="manualVal" style="color:var(--gold);font-size:18px;margin-bottom:12px">50</div>
      <button class="manual-go" onclick="manualGo()">ã“ã‚Œã§åˆ¤å®šï¼</button>
    </div>
  </div>
</div>

<!-- LOADING -->
<div class="sc" id="s-ld">
  <div class="ld-icon">ğŸ”¬</div>
  <div class="ld-text" id="ldText">è§£æä¸­â€¦</div>
</div>

<!-- RESULT -->
<div class="sc scroll" id="s-result"></div>

<script>
// ========== DAILY SEED ==========
const D=new Date(),DS=D.getFullYear()*1e4+(D.getMonth()+1)*100+D.getDate();
let _s=DS;function dr(){_s=(_s*9301+49297)%233280;return _s/233280}

// ========== SAKE DATABASE (from Fukushima DB) ==========
const SAKE={
brake:[ // ãƒ–ãƒ¬ãƒ¼ã‚­é…’ - ã“ã‚Œä»¥ä¸Šã„ããª
  {name:"åå€‰å±± æœˆå¼“ï¼ˆåå€‰å±±é…’é€ ï¼‰",note:"æ—¥æœ¬é…’åº¦-1 / ãã‚Œã„ãªç”˜ã•ã§ãƒ–ãƒ¬ãƒ¼ã‚­ã€‚å„ªã—ãæ­¢ã‚ã¦ãã‚Œã‚‹",temp:"å†·é…’"},
  {name:"ç”²å­å±± ç´”ç±³åŸé†¸ï¼ˆæœ‰è³€é†¸é€ Ã—è¥¿éƒ·æ‘ï¼‰",note:"è¥¿éƒ·æ‘åˆã®åœ°é…’ã€‚é£²ã¿ã‚„ã™ã•ã§ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³",temp:"å†·é…’"},
  {name:"ã‹ã‚’ã‚‹ã‚„ã¾ï¼ˆä»äº•ç”°æœ¬å®¶ï¼‰",note:"ãŠç±³ã®ç™½ãƒ¯ã‚¤ãƒ³ã€‚ä½ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ã§ç€åœ°ã›ã‚ˆ",temp:"å†·é…’"},
  {name:"å±±ã®äº• ç´”ç±³ï¼ˆä¼šæ´¥é…’é€ ï¼‰",note:"ALC14%ã€‚è»½ã‚„ã‹ãƒ¢ãƒ€ãƒ³ã§ã‚½ãƒ•ãƒˆãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°",temp:"å†·é…’"},
  {name:"å¥ˆè‰¯è¬ ç´”ç±³é…’ï¼ˆå¤¢å¿ƒé…’é€ ï¼‰",note:"ã‚„ã‚ã‚‰ã‹ãªæ—¨å‘³ã€‚èƒƒã«å„ªã—ã„ä¸‡èƒ½ãƒ–ãƒ¬ãƒ¼ã‚­",temp:"å†·é…’ï½å¸¸æ¸©"},
  {name:"é›ªå°ç”º ç´”ç±³é…’ï¼ˆæ¸¡è¾ºé…’é€ æœ¬åº—ï¼‰",note:"ç©ã‚„ã‹ã§é£²ã¿ã‚„ã™ã„ã€‚ã“ã“ã§æ­¢ã¾ã‚Œ",temp:"å†·é…’"},
  {name:"æ¦®å· ç‰¹åˆ¥ç´”ç±³é…’ï¼ˆæ¦®å·é…’é€ ï¼‰",note:"ç£æ¢¯å±±ã®æ°´ã€‚ã¾ã‚ã‚„ã‹ãƒ–ãƒ¬ãƒ¼ã‚­",temp:"å†·é…’"},
  {name:"å†©æ¨‚ ç´”ç±³é…’ï¼ˆå®®æ³‰éŠ˜é†¸ï¼‰",note:"ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ã ã‘ã©ã‚­ãƒ¬ãŒã‚ã‚‹ã€‚æ•´ãˆã‚‹ä¸€æ¯",temp:"å†·é…’"},
],
calm:[ // æ•´ãˆã‚‹é…’ - è½ã¡ç€ã‘
  {name:"å¤§ä¸ƒ ç´”ç±³ç”Ÿé…›ï¼ˆå¤§ä¸ƒé…’é€ ï¼‰",note:"ç”Ÿé…›ã®æ·±ã„ã‚³ã‚¯ã€‚ç‡—ã§èƒƒã‚’æ¸©ã‚ã¦æ­£æ°—ã«æˆ»ã‚Œ",temp:"ã¬ã‚‹ç‡—"},
  {name:"ä¼æ‰¿å±±å»ƒç´”ç±³ æœ«å»£ï¼ˆæœ«å»£é…’é€ ï¼‰",note:"å±±å»ƒã®è¤‡é›‘ãªæ—¨å‘³ã€‚ç‡—ã§ç‘æƒ³ã—ã‚",temp:"ã¬ã‚‹ç‡—"},
  {name:"ä¼šæ´¥ä¸­å°† ç´”ç±³é…’ï¼ˆé¶´ä¹ƒæ±Ÿé…’é€ ï¼‰",note:"ç‡—é…’ã‚³ãƒ³ãƒ†ã‚¹ãƒˆé‡‘è³ã€‚æ¸©ã‹ã•ã§æ•´ãˆ",temp:"ç‡—"},
  {name:"ã«ã„ã ã—ãœã‚“ã—ã‚… ç‡—èª‚ï¼ˆä»äº•ç”°æœ¬å®¶ï¼‰",note:"ç‡—å°‚ç”¨è¨­è¨ˆã€‚æ¸©ã‚ã¦ç†æ€§ã‚’å–ã‚Šæˆ»ã›",temp:"ã¬ã‚‹ç‡—"},
  {name:"å›½æ¨© å±±å»ƒç´”ç±³ï¼ˆå›½æ¨©é…’é€ ï¼‰",note:"å—ä¼šæ´¥ã®éª¨æ ¼ã€‚ã—ã£ã‹ã‚Šåº§ã‚Œ",temp:"ç‡—"},
  {name:"èŠ±æ˜¥ æ¿ƒé†‡ç´”ç±³ï¼ˆèŠ±æ˜¥é…’é€ ï¼‰",note:"ç‡—é…’ã‚³ãƒ³ãƒ†ã‚¹ãƒˆé‡‘è³ã€‚æ¿ƒã„ã‚ã§æ•´ã†",temp:"ã¬ã‚‹ç‡—"},
  {name:"å»£æˆ¸å· ç‰¹åˆ¥ç´”ç±³ï¼ˆæ¾å´é…’é€ ï¼‰",note:"ã‚­ãƒ¬é‹­ã„è¾›å£ã€‚é…”ã„ã«ã‚­ãƒ¬ã‚’å…¥ã‚Œã‚",temp:"å†·é…’"},
  {name:"å¼¥å³è¡›é–€ ç´”ç±³è¾›å£ï¼ˆå¤§å’Œå·é…’é€ åº—ï¼‰",note:"+8ã®è¾›å£ã€‚ç”˜ã„å¤¢ã‹ã‚‰è¦šã¾ã›",temp:"å†·é…’"},
],
yolo:[ // é–‹ãç›´ã‚Šé…’ - ã‚‚ã†çŸ¥ã‚‰ã‚“
  {name:"é£›éœ²å–œ ç‰¹åˆ¥ç´”ç±³ï¼ˆå»£æœ¨é…’é€ æœ¬åº—ï¼‰",note:"ã‚‚ã†æ­¢ã¾ã‚‰ãªã„ãªã‚‰æœ€é«˜ã®é…’ã§æ•£ã‚Œ",temp:"å†·é…’"},
  {name:"å†©æ¨‚ ç´”ç±³åŸé†¸ ãŠã‚ŠãŒã‚‰ã¿ï¼ˆå®®æ³‰éŠ˜é†¸ï¼‰",note:"ã‚·ãƒ¥ãƒ¯ã‚·ãƒ¥ãƒ¯ã§åŠ é€Ÿã€‚ã‚‚ã†çŸ¥ã‚‰ã‚“",temp:"å†·é…’"},
  {name:"ãƒ­ä¸‡ ç´”ç±³åŸé†¸ï¼ˆèŠ±æ³‰é…’é€ ï¼‰",note:"ã‚‚ã¡ç±³å››æ®µã®è¯ã‚„ã‹ã•ã€‚æœ€å¾Œã®èŠ±ç«",temp:"å†·é…’"},
  {name:"äººæ°—ä¸€ ã‚ã‚ ç”°ã‚“ã¼ã®ã‚·ãƒ£ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥ï¼ˆäººæ°—é…’é€ ï¼‰",note:"æ³¡ã§é£›ã¹ã€‚æˆ»ã£ã¦ãã‚‹ãª",temp:"å†·é…’"},
  {name:"ã«ã„ã ã—ãœã‚“ã—ã‚… ç´”ç±³åŸé…’ï¼ˆä»äº•ç”°æœ¬å®¶ï¼‰",note:"æ—¥æœ¬é…’åº¦-15ã€‚ç”˜æ—¨ã®æ²¼ã«è½ã¡ã‚",temp:"å†·é…’"},
  {name:"é£›éœ²å–œ ç´”ç±³åŸé†¸ é»’ãƒ©ãƒ™ãƒ«ï¼ˆå»£æœ¨é…’é€ æœ¬åº—ï¼‰",note:"å…¥æ‰‹å›°é›£ã€‚å‡ºä¼šãˆãŸãªã‚‰é£²ã‚€ã—ã‹ãªã„",temp:"å†·é…’"},
  {name:"è”µå¤ªé¼“+10ï¼ˆå–œå¤šã®è¯é…’é€ å ´ï¼‰",note:"è¶…è¾›å£+10ã€‚æœ€å¾Œã®ä¸€æ’ƒ",temp:"å†·é…’"},
  {name:"å»£æˆ¸å· ç„¡æ¿¾éç”ŸåŸé…’ï¼ˆæ¾å´é…’é€ ï¼‰",note:"ç”ŸåŸé…’ã®æš´åŠ›çš„æ—¨å‘³ã€‚é–‹ãç›´ã‚Œ",temp:"å†·é…’"},
]};

// ========== RESULT TEXT ==========
const LEVELS=[
  {min:0,max:19,label:"ç´ é¢",emoji:"ğŸ˜",cls:"lv-sober",
    status:["ã‚·ãƒ©ãƒ•ã™ãã¦é€†ã«å¿ƒé…ã€‚\nãªãœã“ã“ã«ã„ã‚‹ï¼Ÿ","ç´ é¢ã€‚ã¤ã¾ã‚‰ã‚“äººé–“ã®è¨¼æ‹ ã€‚\nã‚‚ã†ä¸€æ¯ã„ã‘ã€‚","å®Œå…¨ã«ã‚·ãƒ©ãƒ•ã€‚\næ¥½ã—ã¿æ–¹ã‚’çŸ¥ã‚‰ãªã„å¯èƒ½æ€§ã€‚","æ¤œå‡ºä¸èƒ½ã€‚\næœ¬å½“ã«é£²ã‚“ã ã®ã‹ï¼Ÿ"],
    prophecy:["æ˜æ—¥ï¼šæ™®é€šã€‚ã¤ã¾ã‚‰ã‚“ã€‚ã‚‚ã†ä¸€å›å¹ã‘ã€‚","æ˜æ—¥ï¼šä½•äº‹ã‚‚ãªãæœã‚’è¿ãˆã‚‹ã€‚é€€å±ˆãªæœã ã€‚","æ˜æ—¥ï¼šäºŒæ—¥é…”ã„ã‚¼ãƒ­ã€‚äººç”Ÿã®äºŒæ—¥é…”ã„ã¯æ²»ã‚‰ãªã„ã€‚","æ˜æ—¥ï¼šèª°ã‚ˆã‚Šã‚‚æ—©ãèµ·ãã‚‹ã€‚è™šã—ã•ã‚‚æ—©ã„ã€‚"]
  },
  {min:20,max:39,label:"ã»ã‚é…”ã„",emoji:"ğŸ˜Š",cls:"lv-tipsy",
    status:["ã„ã„æ„Ÿã˜ã«å…¥ã£ã¦ããŸã€‚\nä»ŠãŒä¸€ç•ªæ¥½ã—ã„ã‚¾ãƒ¼ãƒ³ã€‚","ã»ã‚é…”ã„ã€‚\nã“ã®çŠ¶æ…‹ãŒä¸€ç•ªãƒ¢ãƒ†ã‚‹ã€‚ãŸã¶ã‚“ã€‚","å£ãŒæ»‘ã‚Šã‚„ã™ããªã£ã¦ããŸã€‚\nç§˜å¯†ã¯ä»Šã®ã†ã¡ã«é£²ã¿è¾¼ã‚ã€‚","ã„ã„å¡©æ¢…ã€‚\nã“ã“ã§æ­¢ã¾ã‚Œã‚‹äººé–“ã¯å‰ã„ã€‚"],
    prophecy:["æ˜æ—¥ï¼šæ°—æŒã¡ã„ã„æœã€‚ãŸã¶ã‚“å˜˜ã€‚","æ˜æ—¥ï¼šã‚®ãƒªã‚®ãƒªäººé–“ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ã€‚","æ˜æ—¥ï¼šLINEã‚’è¦‹è¿”ã—ã¦å°‘ã—å¾Œæ‚”ã™ã‚‹ã€‚","æ˜æ—¥ï¼šã€Œã‚ã‚“ã¾ã‚Šé£²ã‚“ã§ãªã„ã€ã¨å˜˜ã‚’ã¤ãã€‚"]
  },
  {min:40,max:59,label:"ä¸Šæ©Ÿå«Œ",emoji:"ğŸ¥³",cls:"lv-happy",
    status:["å®Œå…¨ã«ä¸Šæ©Ÿå«Œã€‚\nã“ã®é¡”ã€å†™çœŸã«æ’®ã‚‰ã‚Œã¦ã‚‹ãã€‚","çµ¶å¥½èª¿ã€‚\nã ãŒè²¡å¸ƒã®ä¸­èº«ã¯çµ¶ä¸èª¿ã€‚","ç¬‘ã„ä¸Šæˆ¸ç™ºå‹•ä¸­ã€‚\nä½•ã‚’è¨€ã£ã¦ã‚‚é¢ç™½ã„çŠ¶æ…‹ã€‚","ãƒ†ãƒ³ã‚·ãƒ§ãƒ³MAXã€‚\næ˜æ—¥ã®ã“ã¨ã¯æ˜æ—¥ã®è‡ªåˆ†ã«ä»»ã›ãŸã€‚"],
    prophecy:["æ˜æ—¥ï¼šè²¡å¸ƒãŒè»½ã„ã€‚è¨˜æ†¶ã‚‚è»½ã„ã€‚","æ˜æ—¥ï¼šã‚¹ãƒãƒ›ã®å†™çœŸãƒ•ã‚©ãƒ«ãƒ€ãŒåœ°ç„ã€‚","æ˜æ—¥ï¼šã€Œæ˜¨æ—¥æ¥½ã—ã‹ã£ãŸã­ã€ã®LINEãŒæ€–ã„ã€‚","æ˜æ—¥ï¼šäºŒæ—¥é…”ã„ã¨å…±ã«è¬ã®ç­‹è‚‰ç—›ã€‚"]
  },
  {min:60,max:79,label:"å±é™ºåŸŸ",emoji:"ğŸ« ",cls:"lv-danger",
    status:["å±é™ºåŸŸçªå…¥ã€‚\næ°´ã‚’é£²ã‚ã€‚ä»Šã™ãã€‚","ç›®ãŒã™ã‚ã£ã¦ããŸã€‚\nå‘¨ã‚Šã®äººã€é€ƒã’ã¦ã€‚","åƒé³¥è¶³ãƒ¬ãƒ™ãƒ«ã€‚\nå¸°ã‚Šã®ã‚¿ã‚¯ã‚·ãƒ¼ã€ä»Šã®ã†ã¡ã«å‘¼ã¹ã€‚","è¨€å‹•ã«è²¬ä»»ãŒæŒã¦ãªã„çŠ¶æ…‹ã€‚\nã‚¹ãƒãƒ›ã‚’é ã‘ã‚ã€‚"],
    prophecy:["æ˜æ—¥ï¼šæ°´ã¨å‹é”ã€‚æ—¢èª­ãŒæ€–ã„ã€‚","æ˜æ—¥ï¼šç›®è¦šã¾ã—ãŒ3å›é³´ã£ã¦ã‚‚èµ·ããªã„ã€‚","æ˜æ—¥ï¼šã€Œã‚‚ã†é£²ã¾ãªã„ã€ã¨èª“ã†ã€‚æ¥é€±ç ´ã‚‹ã€‚","æ˜æ—¥ï¼šé ­ç—›è–¬ã‚’æ¢ã™æ—…ãŒå§‹ã¾ã‚‹ã€‚"]
  },
  {min:80,max:100,label:"ä¼èª¬åŸŸ",emoji:"ğŸ’€",cls:"lv-legend",
    status:["ä¼èª¬åŸŸã€‚\nã‚‚ã¯ã‚„äººé–“ã§ã¯ãªã„ä½•ã‹ã«ãªã£ã¦ã„ã‚‹ã€‚","é™ç•Œçªç ´ã€‚\nã“ã®æ•°å€¤ã€è¨˜éŒ²ã«æ®‹ã—ã¦ã„ã„ã‹ï¼Ÿ","ãƒãƒ¼ãƒ³ã€‚\næ˜æ—¥ã®è‡ªåˆ†ã«è¬ã£ã¦ãŠã‘ã€‚","æ¸¬å®šä¸èƒ½ãƒ¬ãƒ™ãƒ«ã€‚\nç”Ÿãã¦å¸°ã‚Œã€‚ãã‚Œã ã‘ã§ã„ã„ã€‚"],
    prophecy:["æ˜æ—¥ï¼š3æ—¥é…”ã„ç¢ºå®šã€‚ãƒãƒ¼ãƒ³ã€‚","æ˜æ—¥ï¼šå­˜åœ¨ã—ãªã„ã€‚è¨˜æ†¶ã‚‚å­˜åœ¨ã—ãªã„ã€‚","æ˜æ—¥ï¼šèƒƒã¨è‚è‡“ã‹ã‚‰è¨´çŠ¶ãŒå±Šãã€‚","æ˜æ—¥ï¼šã€Œæ˜¨æ—¥ã®ä¿ºã€èª°ï¼Ÿã€çŠ¶æ…‹ã€‚"]
  }
];

const KING_WORDS=[
  "ä»Šå¤œã€ã“ã“ã§æ­¢ã¾ã‚Œã€‚","ãŠå‰ã¯ã¾ã ç«‹ã£ã¦ã„ã‚‹ã€‚ãã‚Œã ã‘ã§ç‹ã ã€‚","é£²ã‚ã€‚ã ãŒã€å¸°ã‚Šé“ã‚’å¿˜ã‚Œã‚‹ãªã€‚",
  "é…”ã„ã¯å˜˜ã‚’ã¤ã‹ãªã„ã€‚ãŠå‰ã®æœ¬éŸ³ãŒå‡ºã¦ã„ã‚‹ã€‚","ä»Šå¤œã®è¨˜æ†¶ã‚’ã€æ˜æ—¥ã®ç³§ã«ã—ã‚ã€‚",
  "ã¾ã é£²ã‚€ã®ã‹ã€‚â€¦å«Œã„ã˜ã‚ƒãªã„ã€‚","ãŠå‰ã®è‚è‡“ãŒæ³£ã„ã¦ã„ã‚‹ã€‚èã“ãˆã‚‹ã‹ã€‚",
  "ä¸€æ¯ã®é…’ã«ã€åƒã®è¨€ã„è¨³ã¯è¦ã‚‰ãªã„ã€‚","æ­¢ã‚æ™‚ã‚’çŸ¥ã‚‹è€…ãŒã€çœŸã®ç‹ã ã€‚",
  "ãƒãƒ¼ãƒ³ã€‚ã ãŒã€ãŠå‰ã¯ç”Ÿãã¦ã„ã‚‹ã€‚ãã‚Œã§ã„ã„ã€‚"
];

// ========== AUDIO STATE ==========
let audioCtx, analyser, micStream, measuring=false;
let volumes=[], startTime=0, animFrame=0;
let canvas, ctx, cW, cH;

// ========== SCREEN NAV ==========
function show(id){document.querySelectorAll('.sc').forEach(s=>s.classList.remove('on'));setTimeout(()=>document.getElementById(id).classList.add('on'),60)}

// ========== START MEASURE ==========
async function startMeasure(){
  // Init canvas
  canvas=document.getElementById('noiseCanvas');
  const rect=canvas.getBoundingClientRect();
  canvas.width=rect.width*2;canvas.height=rect.height*2;
  ctx=canvas.getContext('2d');cW=canvas.width;cH=canvas.height;
  ctx.scale(2,2);

  show('s-measure');
  document.getElementById('manualSlider').classList.remove('show');
  document.getElementById('mTitle').textContent='ğŸŒ¬ ãƒ•ãƒ¼ãƒƒã¨å¹ã„ã¦ï¼';
  document.getElementById('mInst').textContent='ã‚¹ãƒãƒ›ã®ä¸‹ã«å‘ã‹ã£ã¦æ¯ã‚’å¹ãã‹ã‘ã¦ãã ã•ã„';

  try{
    micStream=await navigator.mediaDevices.getUserMedia({audio:true});
    audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    const src=audioCtx.createMediaStreamSource(micStream);
    analyser=audioCtx.createAnalyser();
    analyser.fftSize=512;
    analyser.smoothingTimeConstant=0.3;
    src.connect(analyser);

    volumes=[];
    measuring=true;
    startTime=performance.now();
    measureLoop();
  }catch(e){
    // Mic failed - show manual
    document.getElementById('mTitle').textContent='ğŸ¤ ãƒã‚¤ã‚¯ãŒä½¿ãˆã¾ã›ã‚“';
    document.getElementById('mInst').textContent='æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰ã§æ¸¬å®šã§ãã¾ã™';
    document.getElementById('manualSlider').classList.add('show');
  }
}

function measureLoop(){
  if(!measuring)return;
  const elapsed=(performance.now()-startTime)/1000;
  const remain=Math.max(0,2.0-elapsed);

  // Get volume
  const data=new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(data);
  let sum=0;for(let i=0;i<data.length;i++)sum+=data[i]*data[i];
  const rms=Math.sqrt(sum/data.length);
  const vol=Math.min(100,rms/1.2);
  volumes.push(vol);

  // Update gauge
  const avg=volumes.reduce((a,b)=>a+b,0)/volumes.length;
  const displayVal=Math.min(100,Math.round(avg*1.2+Math.random()*8));
  updateGauge(displayVal);

  // Update timer
  document.getElementById('timerText').textContent=`æ®‹ã‚Š ${remain.toFixed(1)} ç§’`;

  // Draw noise
  drawNoise(vol,data);

  if(elapsed>=2.0){
    measuring=false;
    stopMic();
    finishMeasure();
  }else{
    animFrame=requestAnimationFrame(measureLoop);
  }
}

function updateGauge(val){
  const clamped=Math.max(0,Math.min(100,val));
  document.getElementById('gaugeNum').textContent=Math.round(clamped);
  document.getElementById('gaugeFill').style.width=clamped+'%';
  // Color
  let clr;
  if(clamped<20)clr='var(--cyan)';
  else if(clamped<40)clr='var(--green)';
  else if(clamped<60)clr='var(--yellow)';
  else if(clamped<80)clr='var(--orange)';
  else clr='var(--red3)';
  document.getElementById('gaugeFill').style.background=`linear-gradient(90deg,${clr},${clr}dd)`;
  document.getElementById('gaugeNum').style.color=clr;
}

function drawNoise(vol,data){
  const w=cW/2,h=cH/2;
  ctx.fillStyle='rgba(5,5,8,0.3)';
  ctx.fillRect(0,0,w,h);

  // Frequency bars
  const barW=w/data.length*2;
  for(let i=0;i<data.length;i+=2){
    const v=data[i]/255;
    const barH=v*h*0.8;
    const hue=120-v*120;
    ctx.fillStyle=`hsla(${hue},70%,50%,${0.3+v*0.5})`;
    ctx.fillRect(i/2*barW,h-barH,barW-1,barH);
  }

  // Waveform overlay
  ctx.beginPath();
  ctx.strokeStyle=`rgba(201,168,76,${0.2+vol/200})`;
  ctx.lineWidth=1.5;
  for(let x=0;x<w;x++){
    const idx=Math.floor(x/w*data.length);
    const y=h/2+(data[idx]/255-0.5)*h*0.6+Math.sin(x*0.05+performance.now()*0.003)*vol*0.15;
    x===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  }
  ctx.stroke();
}

function stopMic(){
  if(micStream)micStream.getTracks().forEach(t=>t.stop());
  if(audioCtx)audioCtx.close().catch(()=>{});
  cancelAnimationFrame(animFrame);
}

function cancelMeasure(){
  measuring=false;
  stopMic();
  show('s-intro');
}

// ========== MANUAL MODE ==========
function showManual(){document.getElementById('manualSlider').classList.add('show')}
function updateManualLabel(){document.getElementById('manualVal').textContent=document.getElementById('manualRange').value}
function manualGo(){
  const v=parseInt(document.getElementById('manualRange').value);
  doResult(v);
}

// ========== FINISH MEASURE ==========
function finishMeasure(){
  if(volumes.length===0){doResult(50);return}
  const avg=volumes.reduce((a,b)=>a+b,0)/volumes.length;
  const variance=volumes.reduce((a,b)=>a+(b-avg)**2,0)/volumes.length;

  // Score calculation (entertainment, not science)
  let base=Math.min(80,avg*1.1);
  let vBonus=Math.min(15,Math.sqrt(variance)*0.8);
  let randomShift=(Math.random()-0.5)*20;
  let score=Math.round(base+vBonus+randomShift);
  score=Math.max(0,Math.min(100,score));

  doResult(score);
}

// ========== RESULT ==========
function doResult(score){
  // Show loading
  show('s-ld');
  const ldTexts=["å‘¼æ°—ã‚’è§£æä¸­â€¦","ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«æˆåˆ†ã‚’æ¤œå‡ºâ€¦","é…”ã„åº¦ã‚’ç®—å‡ºä¸­â€¦","åˆ¤å®šå®Œäº†ã€‚"];
  let li=0;
  const ldIv=setInterval(()=>{li++;if(li<ldTexts.length)document.getElementById('ldText').textContent=ldTexts[li]},250);

  setTimeout(()=>{
    clearInterval(ldIv);
    renderResult(score);
  },1200);
}

function renderResult(score){
  const level=LEVELS.find(l=>score>=l.min&&score<=l.max)||LEVELS[0];
  const status=level.status[Math.floor(Math.random()*level.status.length)];
  const prophecy=level.prophecy[Math.floor(Math.random()*level.prophecy.length)];

  // Pick sake
  const brakeSake=SAKE.brake[Math.floor(Math.random()*SAKE.brake.length)];
  const calmSake=SAKE.calm[Math.floor(Math.random()*SAKE.calm.length)];
  const yoloSake=SAKE.yolo[Math.floor(Math.random()*SAKE.yolo.length)];

  // King (10% chance)
  const showKing=Math.random()<0.15;
  const kingWord=KING_WORDS[Math.floor(Math.random()*KING_WORDS.length)];

  const el=document.getElementById('s-result');
  el.innerHTML=`
    <div class="res-emoji fi">${level.emoji}</div>
    <div class="res-label ${level.cls} fi d1">${level.label}</div>
    <div class="res-num ${level.cls} fi d2">${score}</div>
    <div class="res-unit fi d2">ãƒ™ãƒ­</div>

    <div class="res-status fi d3">
      <div class="res-status-title">â–¶ ä»Šå¤œã®ã‚ãªãŸ</div>
      <div class="res-status-text">${status.replace(/\n/g,'<br>')}</div>
    </div>

    <div class="res-prophecy fi d4">
      <div class="res-prophecy-title">ğŸ”® æ˜æ—¥ã®äºˆè¨€</div>
      <div class="res-prophecy-text">${prophecy}</div>
    </div>

    <div class="sake-box fi d5">
      <div class="sake-title">ğŸ¶ ä»Šå¤œã®ãŠã™ã™ã‚æ—¥æœ¬é…’</div>
      <div class="sake-card">
        <div class="sake-role brake">ğŸ›‘ ãƒ–ãƒ¬ãƒ¼ã‚­é…’ â€• ã“ã‚Œä»¥ä¸Šã„ããª</div>
        <div class="sake-name">${brakeSake.name}</div>
        <div class="sake-note">${brakeSake.note}ï½œ${brakeSake.temp}</div>
      </div>
      <div class="sake-card">
        <div class="sake-role calm">ğŸµ æ•´ãˆã‚‹é…’ â€• è½ã¡ç€ã‘</div>
        <div class="sake-name">${calmSake.name}</div>
        <div class="sake-note">${calmSake.note}ï½œ${calmSake.temp}</div>
      </div>
      <div class="sake-card">
        <div class="sake-role yolo">ğŸ”¥ é–‹ãç›´ã‚Šé…’ â€• ã‚‚ã†çŸ¥ã‚‰ã‚“</div>
        <div class="sake-name">${yoloSake.name}</div>
        <div class="sake-note">${yoloSake.note}ï½œ${yoloSake.temp}</div>
      </div>
    </div>

    <div class="king-box fi d6 ${showKing?'show':''}">
      <div class="king-label">ä¸–ç•Œç‹ã®åˆ¤å®š</div>
      <div class="king-text">ã€Œ${kingWord}ã€</div>
    </div>

    <button class="retry-btn fi d7" onclick="retry()">ğŸŒ¬ ã‚‚ã†ä¸€å›æ¸¬ã‚‹</button>
    <div class="ft fi d8">Presented by ä¸–ç•Œç‹<br>ã€Œã™ã¹ã¦ã®äººã¯ã€è‡ªåˆ†ã®å¤œã®ç‹ã§ã‚ã‚‹ã€‚ã€</div>
  `;

  show('s-result');
}

function retry(){
  document.getElementById('s-result').scrollTo(0,0);
  show('s-intro');
}
</script>
</body>
</html>
